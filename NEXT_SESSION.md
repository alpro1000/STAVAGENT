# NEXT_SESSION.md - Session Summary 2025-12-19

**Date:** 2025-12-19
**Status:** ‚úÖ Session Complete
**Branch:** `claude/fix-sidebar-custom-work-hbtGl` (–≥–æ—Ç–æ–≤ –∫ merge)

---

## Session Summary

### ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ –≤ —ç—Ç–æ–π —Å–µ—Å—Å–∏–∏

#### 1. Security Fixes (P0)
**Commit:** `3a84cb1`

| –ü—Ä–æ–±–ª–µ–º–∞ | –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ |
|----------|-------------|
| SQL Injection –≤ `positions.js` | –î–æ–±–∞–≤–ª–µ–Ω whitelist `ALLOWED_UPDATE_FIELDS` |
| JSON.parse crash | –í—Å–µ 3 –≤—ã–∑–æ–≤–∞ –æ–±—ë—Ä–Ω—É—Ç—ã –≤ try/catch —Å fallback |

```javascript
// positions.js:19-23
const ALLOWED_UPDATE_FIELDS = new Set([
  'part_name', 'item_name', 'subtype', 'unit', 'qty', 'qty_m3_helper',
  'crew_size', 'wage_czk_ph', 'shift_hours', 'days', 'otskp_code',
  'concrete_m3', 'cost_czk', 'metadata', 'position_number'
]);
```

#### 2. –ù–æ–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ —Å–∫–æ—Ä–æ—Å—Ç–∏ —Ä–∞–±–æ—Ç (MJ/h)
**Commits:** `3df7183`, `2fb938b`

**–§–æ—Ä–º—É–ª–∞:**
```
Rychlost (MJ/hod) = Mno≈æstv√≠ / Celkov√©_hodiny

–ì–¥–µ: Celkov√©_hodiny = Poƒçet_lid√≠ √ó Hod./den √ó Dny
```

**–î–≤—É–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π —Ä–∞—Å—á—ë—Ç:**
- –í–≤—ë–ª –Ω–æ—Ä–º—É ‚Üí –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞—é—Ç—Å—è –¥–Ω–∏
- –í–≤—ë–ª –¥–Ω–∏ ‚Üí –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –Ω–æ—Ä–º–∞ (–¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è —Å–æ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–æ–º)

**–ò–∑–º–µ–Ω—ë–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:**
| –§–∞–π–ª | –ò–∑–º–µ–Ω–µ–Ω–∏–µ |
|------|-----------|
| `PositionsTable.tsx:441` | –ó–∞–≥–æ–ª–æ–≤–æ–∫ –∫–æ–ª–æ–Ω–∫–∏ "MJ/h" |
| `PositionRow.tsx:226-264` | –†–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º–∞—è —è—á–µ–π–∫–∞ —Å —Ñ–æ—Ä–º—É–ª–æ–π |
| `components.css:1165-1168` | CSS —Å—Ç–∏–ª—å `.col-rychlost` |

---

## –û–±—Å—É–∂–¥—ë–Ω–Ω—ã–µ, –Ω–æ –ù–ï —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∏–¥–µ–∏

### 1. –î–∏–∑–∞–π–Ω "Digital Concrete / Brutal-Neumo"
**–°—Ç–∞—Ç—É—Å:** –°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è –≥–æ—Ç–æ–≤–∞, –∂–¥—ë—Ç —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏—è

**–¢–æ–∫–µ–Ω—ã (–≥–æ—Ç–æ–≤—ã –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é):**
```css
--app-bg-concrete:    #C9CBCD;
--panel-bg-concrete:  #CFD1D3;
--brand-orange:       #FF9F1C;
--danger-red:         #B71C1C;
--elev-low:  3px 3px 6px var(--shadow-dark), -3px -3px 6px var(--shadow-light);
```

**–ü—Ä–æ–±–ª–µ–º—ã:**
- –ö–æ–Ω—Ç—Ä–∞—Å—Ç —Ç–µ–∫—Å—Ç–∞ 3.8:1 < 4.5:1 WCAG (–Ω—É–∂–Ω–æ –ø–æ–¥–Ω—è—Ç—å)
- –ù—É–∂–Ω–æ —Ä–µ—à–∏—Ç—å: –∑–∞–º–µ–Ω—è—Ç—å dark mode –∏–ª–∏ –¥–≤–µ —Ç–µ–º—ã?

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –í–Ω–µ–¥—Ä—è—Ç—å –ø–æ—ç—Ç–∞–ø–Ω–æ: –∫–Ω–æ–ø–∫–∏ ‚Üí header ‚Üí –ø–æ–ª–Ω—ã–π —Ñ–æ–Ω

### 2. LLM –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ Monolit Planner
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã–µ —Ñ–∏—á–∏:**

| –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç | –§–∏—á–∞ | –°–ª–æ–∂–Ω–æ—Å—Ç—å |
|-----------|------|-----------|
| ü•á | AI –ø–æ–¥—Å–∫–∞–∑–∫–∞ –Ω–æ—Ä–º (MJ/hod) | –°—Ä–µ–¥–Ω—è—è |
| ü•à | –£–º–Ω—ã–π –∏–º–ø–æ—Ä—Ç XLSX | –í—ã—Å–æ–∫–∞—è |
| ü•â | –ß–∞—Ç-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç | –°—Ä–µ–¥–Ω—è—è |

**–§–ª–∞–≥ —É–∂–µ –µ—Å—Ç—å:** `FF_AI_DAYS_SUGGEST: boolean` –≤ `ProjectConfig`

### 3. –ú–æ–±–∏–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è
**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** PWA + read-only dashboard

| –§–∞–∑–∞ | –û–ø–∏—Å–∞–Ω–∏–µ | –í—Ä–µ–º—è |
|------|----------|-------|
| 1 | Mobile dashboard (read-only) | 2 –Ω–µ–¥–µ–ª–∏ |
| 2 | PWA (–æ—Ñ–ª–∞–π–Ω, —É—Å—Ç–∞–Ω–æ–≤–∫–∞) | 1 –Ω–µ–¥–µ–ª—è |
| 3 | Card-based UI –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è | 3-4 –Ω–µ–¥–µ–ª–∏ |

**–ü—Ä–æ–±–ª–µ–º–∞:** –¢–∞–±–ª–∏—Ü–∞ 15 –∫–æ–ª–æ–Ω–æ–∫ –Ω–µ –≤–ª–µ–∑–∞–µ—Ç –Ω–∞ 375px ‚Üí –Ω—É–∂–µ–Ω card-based UI

---

## –î–ª—è —Å–ª–µ–¥—É—é—â–µ–π —Å–µ—Å—Å–∏–∏

### –ù–µ–º–µ–¥–ª–µ–Ω–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è:
```bash
# 1. Merge PR
git checkout main
git merge claude/fix-sidebar-custom-work-hbtGl
git push origin main

# 2. Manual Deploy –Ω–∞ Render
# ‚Üí monolit-planner-frontend
# ‚Üí monolit-planner-api

# 3. –¢–µ—Å—Ç
# - –ó–∞–≥—Ä—É–∑–∏—Ç—å XLSX ‚Üí –ø—Ä–æ–≤–µ—Ä–∏—Ç—å sidebar
# - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–ª–æ–Ω–∫—É MJ/h (–≤–≤–µ—Å—Ç–∏ –Ω–æ—Ä–º—É ‚Üí –¥–Ω–∏ –ø–µ—Ä–µ—Å—á–∏—Ç–∞—é—Ç—Å—è)
```

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã:
1. **Merge & Deploy** —Ç–µ–∫—É—â–∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π
2. **–î–∏–∑–∞–π–Ω** ‚Äî —Å–æ–≥–ª–∞—Å–æ–≤–∞—Ç—å –ø–æ–¥—Ö–æ–¥ –∫ Brutal-Neumo
3. **LLM** ‚Äî –Ω–∞—á–∞—Ç—å —Å AI –ø–æ–¥—Å–∫–∞–∑–∫–∏ –Ω–æ—Ä–º
4. **Mobile** ‚Äî –µ—Å–ª–∏ –Ω—É–∂–Ω–æ, –Ω–∞—á–∞—Ç—å —Å dashboard

---

## –§–∞–π–ª—ã –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞

| –§–∞–π–ª | –ó–∞—á–µ–º —á–∏—Ç–∞—Ç—å |
|------|--------------|
| `/CLAUDE.md` | –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –≤—Å–µ–π —Å–∏—Å—Ç–µ–º—ã STAVAGENT |
| `/Monolit-Planner/CLAUDE.MD` | –î–µ—Ç–∞–ª–∏ –∫–∏–æ—Å–∫–∞, —Ñ–æ—Ä–º—É–ª—ã, API |
| `PositionRow.tsx:226-264` | –ù–æ–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ —Å–∫–æ—Ä–æ—Å—Ç–∏ MJ/h |
| `positions.js:19-23, 300-307` | SQL injection whitelist |

---

## Quick Commands

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å –±—Ä–∞–Ω—á–∞
git log main..claude/fix-sidebar-custom-work-hbtGl --oneline

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å production health
curl -s https://monolit-planner-api.onrender.com/health

# –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞
cd Monolit-Planner
cd shared && npm run build && cd ..
cd backend && npm run dev &
cd ../frontend && npm run dev
```

---

**Last Updated:** 2025-12-19
