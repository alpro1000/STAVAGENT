<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>URS Matcher Kiosk</title>
  <link rel="stylesheet" href="/styles.css">
</head>
<body>
  <div id="root" class="app-container">
    <header class="app-header">
      <!-- Theme Toggle Button -->
      <button id="themeToggle" class="c-theme-toggle" aria-label="Toggle theme">
        <span id="themeIcon">üåô</span>
        <span id="themeText">Tmav√Ω re≈æim</span>
      </button>

      <div class="header-content">
        <h1>URS Matcher Kiosk</h1>
        <p class="subtitle">Automatick√© vyhled√°n√≠ pozic v katalogu √öRS</p>
      </div>
    </header>

    <main class="app-main">
      <!-- Main Upload Section -->
      <div id="uploadSection" class="section active">
        <div class="section-content">
          <h2>Mo≈ænosti zpracov√°n√≠</h2>

          <div class="action-grid">
            <!-- File Upload -->
            <div class="action-card">
              <div class="action-icon">üìÅ</div>
              <h3>Nahr√°t soubor</h3>
              <p>Excel (.xlsx), ODS (.ods) nebo CSV (.csv)</p>

              <div class="file-upload-area" id="fileDropZone">
                <input type="file" id="fileInput" accept=".xlsx,.xls,.ods,.csv" hidden>
                <span class="upload-text">Kliknƒõte nebo t√°hnƒõte soubor sem</span>
              </div>

              <textarea id="projectContextInput" placeholder='Kontext projektu (voliteln√©, JSON form√°t):&#10;{"building_type":"bytov√Ω d≈Øm","storeys":4,"main_system":["Porotherm","≈ΩB"]}' rows="3"></textarea>

              <!-- Processing Mode Selection -->
              <div class="processing-mode">
                <label class="mode-toggle">
                  <input type="checkbox" id="advancedModeCheckbox">
                  <span class="mode-label">
                    <strong>Roz≈°√≠≈ôen√Ω re≈æim</strong>
                    <span class="mode-description">Multi-Role AI validace (pomalej≈°√≠, pro slo≈æit√© TZ a dokumentaci)</span>
                  </span>
                </label>
              </div>

              <div class="action-buttons">
                <button class="btn btn-primary" id="processFileBtn" disabled>
                  üìä Zpracovat soubor
                </button>
              </div>
              <p class="action-hint" id="processingHint">‚ö° Rychl√Ω re≈æim: optimalizovan√Ω pipeline (Gemini + Local DB + Perplexity)</p>
            </div>

            <!-- Text Input -->
            <div class="action-card">
              <div class="action-icon">‚úèÔ∏è</div>
              <h3>Vlo≈æit text ruƒçnƒõ</h3>
              <p>Jedn√° polo≈æka, nap≈ô√≠klad: "Beton C25/30 - 25 m3"</p>

              <textarea id="textInput" placeholder="Podkladn√≠ beton C25/30 tl. 100 mm pod ZD&#10;Mno≈æstv√≠: 25 m3&#10;MJ: m3" rows="4"></textarea>

              <div class="text-input-controls">
                <input type="number" id="quantityInput" placeholder="Mno≈æstv√≠" value="0" min="0" step="0.1">
                <input type="text" id="unitInput" placeholder="MJ (m3, m2, ks...)" value="m3">
              </div>

              <button class="btn btn-primary" id="matchBtn">
                Vyhledat pozice
              </button>
            </div>

            <!-- Document Upload (Phase 2) -->
            <div class="action-card">
              <div class="action-icon">üìÑ</div>
              <h3>Nahr√°t Dokumenty</h3>
              <p>PDF, XLSX, DWG, JPG a dal≈°√≠</p>

              <button class="btn btn-primary" id="openDocUploadBtn">
                üìÑ Nahr√°t Dokumenty
              </button>
            </div>

            <!-- Batch Mode (NEW) -->
            <div class="action-card">
              <div class="action-icon">üìã</div>
              <h3>D√°vkov√© zpracov√°n√≠</h3>
              <p>Seznam pozic ‚Üí automatick√© vyhled√°n√≠ √öRS k√≥d≈Ø</p>

              <button class="btn btn-primary" id="openBatchBtn">
                üìã D√°vkov√Ω re≈æim
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Document Upload Section (Phase 2) -->
      <div id="docUploadSection" class="section hidden">
        <div id="documentUploadContainer"></div>
      </div>

      <!-- Context Editor Section (Phase 2) -->
      <div id="contextEditorSection" class="section hidden">
        <div id="contextEditorContainer"></div>
      </div>

      <!-- Batch Mode Section (NEW) -->
      <div id="batchSection" class="section hidden">
        <div class="section-content">
          <div class="results-header">
            <h2>üìã D√°vkov√© zpracov√°n√≠</h2>
            <button class="btn btn-secondary" id="backFromBatchBtn">‚Üê Zpƒõt</button>
          </div>

          <!-- Input Area -->
          <div class="batch-input-area">
            <h3>Vstup</h3>
            <textarea id="batchTextInput" placeholder="Vlo≈æte seznam pozic (ka≈æd√° na nov√©m ≈ô√°dku):&#10;V√Ωkop stavebn√≠ j√°my kat. 3&#10;Beton C 25/30 vƒç. doprava&#10;V√Ωztu≈æ B 500" rows="10"></textarea>

            <!-- Settings -->
            <div class="batch-settings">
              <h4>Nastaven√≠</h4>
              <div class="settings-grid">
                <label>
                  Kandid√°t≈Ø na pr√°ci:
                  <select id="batchCandidatesPerWork">
                    <option value="3">3</option>
                    <option value="4" selected>4</option>
                    <option value="5">5</option>
                  </select>
                </label>
                <label>
                  Hloubka hled√°n√≠:
                  <select id="batchSearchDepth">
                    <option value="quick">Rychl√°</option>
                    <option value="normal" selected>Norm√°ln√≠</option>
                    <option value="deep">Hlubok√°</option>
                  </select>
                </label>
              </div>
            </div>

            <div class="batch-actions">
              <button class="btn btn-primary" id="batchStartBtn">
                üöÄ Spustit zpracov√°n√≠
              </button>
              <button class="btn btn-secondary" id="batchPauseBtn" disabled>
                ‚è∏Ô∏è Pozastavit
              </button>
            </div>
          </div>

          <!-- Progress Area -->
          <div class="batch-progress" id="batchProgressArea" style="display: none;">
            <h3>Pr≈Øbƒõh zpracov√°n√≠</h3>
            <div class="progress-bar-container">
              <div class="progress-bar" id="batchProgressBar" style="width: 0%;"></div>
            </div>
            <p class="progress-text" id="batchProgressText">0 / 0 (0%)</p>
            <p class="progress-details">
              <span id="batchNeedsReview">‚ö†Ô∏è Kontrola: 0</span> |
              <span id="batchErrors">‚ùå Chyby: 0</span>
            </p>
          </div>

          <!-- Results Table -->
          <div class="batch-results" id="batchResultsArea" style="display: none;">
            <h3>V√Ωsledky</h3>
            <div class="table-wrapper">
              <table class="results-table" id="batchResultsTable">
                <thead>
                  <tr>
                    <th>‚Ññ</th>
                    <th>P≈Øvodn√≠ text</th>
                    <th>Typ</th>
                    <th>√öRS K√≥d</th>
                    <th>N√°zev</th>
                    <th>Sk√≥re</th>
                    <th>Jistota</th>
                    <th>Kontrola</th>
                  </tr>
                </thead>
                <tbody id="batchResultsBody">
                  <!-- Results will be inserted here -->
                </tbody>
              </table>
            </div>

            <div class="results-actions">
              <button class="btn btn-success" id="batchExportBtn">
                üì• St√°hnout Excel
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Results Section -->
      <div id="resultsSection" class="section hidden">
        <div class="section-content">
          <div class="results-header">
            <h2 id="resultsTitle">V√Ωsledky hled√°n√≠</h2>
            <button class="btn btn-secondary" id="backBtn">‚Üê Zpƒõt</button>
          </div>

          <div id="resultsContainer" class="results-container">
            <div class="loading">Naƒç√≠t√°n√≠ v√Ωsledk≈Ø...</div>
          </div>

          <div class="results-actions">
            <button class="btn btn-success" id="exportBtn">
              üì• St√°hnout Excel
            </button>
            <button class="btn btn-secondary" id="copyBtn">
              üìã Kop√≠rovat do schr√°nky
            </button>
          </div>
        </div>
      </div>

      <!-- Phase 3 Advanced Results Section -->
      <div id="phase3ResultsSection" class="section hidden">
        <div class="section-content">
          <div class="results-header">
            <h2>ü§ñ Anal√Ωza V√≠cerol√≠ (Phase 3 Advanced)</h2>
            <button class="btn btn-secondary" id="backFromPhase3Btn">‚Üê Zpƒõt</button>
          </div>

          <!-- Complexity Classification -->
          <div id="complexitySection" class="info-panel">
            <h3>üìä Klasifikace Slo≈æitosti</h3>
            <div class="complexity-grid">
              <div class="complexity-card">
                <span class="complexity-level" id="complexityLevel"></span>
                <p id="complexityDescription"></p>
              </div>
              <div class="complexity-details">
                <p>üìà Poƒçet ≈ô√°dk≈Ø: <span id="rowCount"></span></p>
                <p>‚úÖ √öplnost dat: <span id="completenessScore"></span>%</p>
                <p>üîë Speci√°ln√≠ kl√≠ƒçov√° slova: <span id="specialKeywords"></span></p>
              </div>
            </div>
          </div>

          <!-- Selected Roles -->
          <div id="rolesSection" class="info-panel">
            <h3>üë• Vybran√© Role Specialist≈Ø</h3>
            <div class="roles-grid" id="rolesGrid">
              <!-- Generated dynamically -->
            </div>
          </div>

          <!-- Conflict Detection -->
          <div id="conflictSection" class="info-panel" style="display: none;">
            <h3>‚ö†Ô∏è Detekovan√© Konflikty</h3>
            <div id="conflictsList" class="conflicts-list">
              <!-- Generated dynamically -->
            </div>
          </div>

          <!-- Analysis Results -->
          <div id="analysisSection" class="info-panel">
            <h3>üìã V√Ωsledky Anal√Ωzy</h3>
            <div id="analysisResults" class="analysis-results">
              <!-- Generated dynamically -->
            </div>
          </div>

          <!-- Audit Trail -->
          <div id="auditSection" class="info-panel" style="display: none;">
            <h3>üìù Audit Trail</h3>
            <div id="auditTrail" class="audit-trail">
              <!-- Generated dynamically -->
            </div>
          </div>
        </div>
      </div>

      <!-- Error Section -->
      <div id="errorSection" class="section hidden">
        <div class="section-content error-content">
          <h2>‚ùå Chyba</h2>
          <p id="errorMessage"></p>
          <button class="btn btn-secondary" id="errorBackBtn">
            ‚Üê Zpƒõt na √∫vod
          </button>
        </div>
      </div>
    </main>

    <footer class="app-footer">
      <p>URS Matcher Service v1.0 | <a href="/health">Stav syst√©mu</a></p>
    </footer>
  </div>

  <script src="/app.js"></script>
  <script src="/batch.js"></script>
</body>
</html>
