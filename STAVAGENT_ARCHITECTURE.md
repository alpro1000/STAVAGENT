# ğŸ—ï¸ STAVAGENT: ĞĞ Ğ¥Ğ˜Ğ¢Ğ•ĞšĞ¢Ğ£Ğ ĞĞĞ• ĞĞŸĞ˜Ğ¡ĞĞĞ˜Ğ•

**Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ:** v1.0 (Monorepo consolidation)
**Ğ”Ğ°Ñ‚Ğ°:** 2024-11-21

---

## ğŸ¯ Ğ’Ğ«Ğ¡ĞĞšĞĞ£Ğ ĞĞ’ĞĞ•Ğ’ĞĞ¯ ĞĞ Ğ¥Ğ˜Ğ¢Ğ•ĞšĞ¢Ğ£Ğ Ğ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        USERS / BROWSERS                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                      â”‚                      â”‚
         â†“                      â†“                      â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Monolit-Planner   â”‚ â”‚ stavagent-portal â”‚ â”‚  Future Projects â”‚
â”‚     FRONTEND        â”‚ â”‚    FRONTEND      â”‚ â”‚     (Planned)    â”‚
â”‚  (Vite + React 18)  â”‚ â”‚ (Vite + React 18)â”‚ â”‚                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                      â”‚                      â”‚
         â†“                      â†“                      â†“
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â†“                        â†“
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚  Monolit-Planner    â”‚  â”‚ stavagent-portal   â”‚
         â”‚     BACKEND         â”‚  â”‚     BACKEND        â”‚
         â”‚ (Express + SQLite)  â”‚  â”‚ (Express + SQLite) â”‚
         â”‚                     â”‚  â”‚                    â”‚
         â”‚ Routes:             â”‚  â”‚ Routes:            â”‚
         â”‚ â€¢ /api/positions    â”‚  â”‚ â€¢ /api/projects    â”‚
         â”‚ â€¢ /api/bridges      â”‚  â”‚ â€¢ /api/users       â”‚
         â”‚ â€¢ /api/analysis     â”‚  â”‚ â€¢ /api/uploads     â”‚
         â”‚ â€¢ /api/otskp        â”‚  â”‚ â€¢ /api/kiosk       â”‚
         â”‚ â€¢ /api/export       â”‚  â”‚ â€¢ /api/auth        â”‚
         â”‚ â€¢ /api/auth         â”‚  â”‚ â€¢ /api/otskp       â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚                        â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                        â”‚
                    â†“                        â†“
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚  SQLite DB   â”‚        â”‚  SQLite DB   â”‚
            â”‚  monolit.db  â”‚        â”‚  portal.db   â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


Deployment on Render:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  RENDER.COM                                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  Service 1: monolit-planner-api                            â”‚
â”‚  â”œâ”€â”€ Repository: alpro1000/STAVAGENT                       â”‚
â”‚  â”œâ”€â”€ Root: Monolit-Planner/                                â”‚
â”‚  â”œâ”€â”€ Build: npm install                                    â”‚
â”‚  â”œâ”€â”€ Start: npm start                                      â”‚
â”‚  â””â”€â”€ URL: https://monolit-planner-api.onrender.com        â”‚
â”‚                                                             â”‚
â”‚  Service 2: stavagent-portal-backend                       â”‚
â”‚  â”œâ”€â”€ Repository: alpro1000/STAVAGENT                       â”‚
â”‚  â”œâ”€â”€ Root: stavagent-portal/                               â”‚
â”‚  â”œâ”€â”€ Build: npm install                                    â”‚
â”‚  â”œâ”€â”€ Start: npm start                                      â”‚
â”‚  â””â”€â”€ URL: https://stavagent-portal-backend.onrender.com   â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“¦ ĞšĞĞœĞŸĞĞĞ•ĞĞ¢-WISE ĞĞ Ğ¥Ğ˜Ğ¢Ğ•ĞšĞ¢Ğ£Ğ Ğ

### 1. MONOLIT-PLANNER

**ĞĞ°Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ:** ĞšĞ°Ğ»ÑŒĞºÑƒĞ»ÑÑ‚Ğ¾Ñ€ Ğ¼Ğ¾ÑÑ‚Ğ¾Ğ²Ñ‹Ñ… ĞºĞ¾Ğ½ÑÑ‚Ñ€ÑƒĞºÑ†Ğ¸Ğ¹

#### Backend Structure

```
Monolit-Planner/backend/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ server.js                      (Entry point)
â”‚   â”‚
â”‚   â”œâ”€â”€ routes/
â”‚   â”‚   â”œâ”€â”€ auth.js                    (ĞÑƒÑ‚ĞµĞ½Ñ‚Ğ¸Ñ„Ğ¸ĞºĞ°Ñ†Ğ¸Ñ)
â”‚   â”‚   â”œâ”€â”€ admin.js                   (ĞĞ´Ğ¼Ğ¸Ğ½Ğ¸ÑÑ‚Ñ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ)
â”‚   â”‚   â”œâ”€â”€ positions.js               (Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ¿Ğ¾Ğ·Ğ¸Ñ†Ğ¸ÑĞ¼Ğ¸)
â”‚   â”‚   â”œâ”€â”€ bridges.js                 (Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ¼Ğ¾ÑÑ‚Ğ°Ğ¼Ğ¸)
â”‚   â”‚   â”œâ”€â”€ snapshots.js               (Ğ’ĞµÑ€ÑĞ¸Ğ¾Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ)
â”‚   â”‚   â”œâ”€â”€ upload.js                  (Ğ—Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²)
â”‚   â”‚   â”œâ”€â”€ otskp.js                   (Ğ¦ĞµĞ½Ğ¾Ğ²Ğ¾Ğ¹ ĞºĞ°Ñ‚Ğ°Ğ»Ğ¾Ğ³)
â”‚   â”‚   â”œâ”€â”€ export.js                  (Ğ­ĞºÑĞ¿Ğ¾Ñ€Ñ‚ Excel)
â”‚   â”‚   â”œâ”€â”€ sheathing.js               (Ğ Ğ°ÑÑ‡Ñ‘Ñ‚Ñ‹ Ğ¾Ğ¿Ğ°Ğ»ÑƒĞ±ĞºĞ¸)
â”‚   â”‚   â”œâ”€â”€ parts.js                   (Ğ”ĞµÑ‚Ğ°Ğ»Ğ¸ ĞºĞ¾Ğ½ÑÑ‚Ñ€ÑƒĞºÑ†Ğ¸Ğ¸)
â”‚   â”‚   â”œâ”€â”€ documents.js               (Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ğ¼Ğ¸)
â”‚   â”‚   â””â”€â”€ config.js                  (ĞšĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ)
â”‚   â”‚
â”‚   â”œâ”€â”€ middleware/
â”‚   â”‚   â”œâ”€â”€ auth.js                    (JWT verification)
â”‚   â”‚   â””â”€â”€ errorHandler.js
â”‚   â”‚
â”‚   â”œâ”€â”€ controllers/
â”‚   â”‚   â”œâ”€â”€ positionController.js
â”‚   â”‚   â”œâ”€â”€ bridgeController.js
â”‚   â”‚   â””â”€â”€ analysisController.js
â”‚   â”‚
â”‚   â”œâ”€â”€ models/
â”‚   â”‚   â”œâ”€â”€ Position.js
â”‚   â”‚   â”œâ”€â”€ Bridge.js
â”‚   â”‚   â”œâ”€â”€ Project.js
â”‚   â”‚   â””â”€â”€ User.js
â”‚   â”‚
â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”œâ”€â”€ analysisService.js         (Ğ Ğ°ÑÑ‡Ñ‘Ñ‚Ğ½Ğ°Ñ Ğ»Ğ¾Ğ³Ğ¸ĞºĞ°)
â”‚   â”‚   â”œâ”€â”€ parsingService.js          (ĞŸĞ°Ñ€ÑĞ¸Ğ½Ğ³ Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ¾Ğ²)
â”‚   â”‚   â”œâ”€â”€ excelExportService.js      (Ğ­ĞºÑĞ¿Ğ¾Ñ€Ñ‚ Ğ² Excel)
â”‚   â”‚   â””â”€â”€ otskpService.js            (OTSKP Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ)
â”‚   â”‚
â”‚   â”œâ”€â”€ utils/
â”‚   â”‚   â”œâ”€â”€ validators.js
â”‚   â”‚   â”œâ”€â”€ fileUpload.js
â”‚   â”‚   â””â”€â”€ helpers.js
â”‚   â”‚
â”‚   â””â”€â”€ db/
â”‚       â”œâ”€â”€ init.js                    (Ğ˜Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ğ‘Ğ”)
â”‚       â””â”€â”€ schemas/
â”‚           â”œâ”€â”€ positions.sql
â”‚           â”œâ”€â”€ bridges.sql
â”‚           â””â”€â”€ users.sql
â”‚
â”œâ”€â”€ package.json
â”‚   â”œâ”€â”€ dependencies: express, better-sqlite3, bcrypt, jsonwebtoken
â”‚   â””â”€â”€ engines: node >=18.0.0
â”‚
â””â”€â”€ .env.example
    â”œâ”€â”€ NODE_ENV=production
    â”œâ”€â”€ PORT=3001
    â”œâ”€â”€ DB_PATH=./data/monolit.db
    â””â”€â”€ JWT_SECRET=...
```

#### Frontend Structure

```
Monolit-Planner/frontend/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ main.tsx                       (Entry point)
â”‚   â”œâ”€â”€ App.tsx                        (Root component)
â”‚   â”‚
â”‚   â”œâ”€â”€ pages/
â”‚   â”‚   â”œâ”€â”€ LoginPage.tsx
â”‚   â”‚   â”œâ”€â”€ DashboardPage.tsx
â”‚   â”‚   â”œâ”€â”€ BridgeListPage.tsx
â”‚   â”‚   â”œâ”€â”€ BridgeDetailPage.tsx
â”‚   â”‚   â”œâ”€â”€ AnalysisPage.tsx
â”‚   â”‚   â”œâ”€â”€ DocumentUploadPage.tsx
â”‚   â”‚   â”œâ”€â”€ AdminDashboard.tsx
â”‚   â”‚   â”œâ”€â”€ SettingsPage.tsx
â”‚   â”‚   â””â”€â”€ 404Page.tsx
â”‚   â”‚
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ MainApp.tsx
â”‚   â”‚   â”œâ”€â”€ Sidebar.tsx                (Navigation)
â”‚   â”‚   â”œâ”€â”€ Header.tsx                 (Top bar)
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ ProtectedRoute.tsx         (Auth wrapper)
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ BridgeComponents/
â”‚   â”‚   â”‚   â”œâ”€â”€ BridgeForm.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ PositionTable.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ BridgeCard.tsx
â”‚   â”‚   â”‚   â””â”€â”€ BridgeViewer.tsx
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ AnalysisComponents/
â”‚   â”‚   â”‚   â”œâ”€â”€ AnalysisPreview.tsx    (HUGE: 13,238 LOC)
â”‚   â”‚   â”‚   â”œâ”€â”€ ResultsChart.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ SnapshotsManager.tsx
â”‚   â”‚   â”‚   â””â”€â”€ ComparisonView.tsx
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ FileUploadComponents/
â”‚   â”‚   â”‚   â”œâ”€â”€ DocumentUpload.tsx     (6,562 LOC)
â”‚   â”‚   â”‚   â”œâ”€â”€ UploadProgress.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ FilePreview.tsx
â”‚   â”‚   â”‚   â””â”€â”€ ParsingResults.tsx
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ OtskpComponents/
â”‚   â”‚   â”‚   â”œâ”€â”€ OtskpAutocomplete.tsx  (5,000 LOC)
â”‚   â”‚   â”‚   â”œâ”€â”€ OtskpDetails.tsx
â”‚   â”‚   â”‚   â””â”€â”€ PricingTable.tsx
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ AdminComponents/
â”‚   â”‚       â”œâ”€â”€ UserManagement.tsx
â”‚   â”‚       â”œâ”€â”€ AuditLogs.tsx
â”‚   â”‚       â””â”€â”€ SystemStats.tsx
â”‚   â”‚
â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”œâ”€â”€ api.ts                     (Axios wrapper - 527 LOC)
â”‚   â”‚   â”‚   â”œâ”€â”€ GET /api/positions
â”‚   â”‚   â”‚   â”œâ”€â”€ POST /api/positions
â”‚   â”‚   â”‚   â”œâ”€â”€ GET /api/bridges
â”‚   â”‚   â”‚   â”œâ”€â”€ POST /api/bridges
â”‚   â”‚   â”‚   â”œâ”€â”€ GET /api/analysis/{id}
â”‚   â”‚   â”‚   â””â”€â”€ POST /api/export
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ http.ts                    (Interceptors, error handling)
â”‚   â”‚
â”‚   â”œâ”€â”€ context/
â”‚   â”‚   â”œâ”€â”€ AuthContext.tsx            (100 LOC - DUPLICATED!)
â”‚   â”‚   â”‚   â””â”€â”€ useAuth() hook
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ AppContext.tsx             (Global state)
â”‚   â”‚
â”‚   â”œâ”€â”€ hooks/
â”‚   â”‚   â”œâ”€â”€ useAuth.ts                 (Auth logic)
â”‚   â”‚   â”œâ”€â”€ useBridges.ts              (Bridge CRUD)
â”‚   â”‚   â”œâ”€â”€ usePositions.ts            (Position CRUD)
â”‚   â”‚   â”œâ”€â”€ useQuery.ts                (React Query wrapper)
â”‚   â”‚   â”œâ”€â”€ useLocalStorage.ts
â”‚   â”‚   â”œâ”€â”€ useDebounce.ts
â”‚   â”‚   â””â”€â”€ useWindowSize.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ styles/
â”‚   â”‚   â”œâ”€â”€ global.css
â”‚   â”‚   â”œâ”€â”€ components.css
â”‚   â”‚   â”œâ”€â”€ layout.css
â”‚   â”‚   â””â”€â”€ [component-name].module.css
â”‚   â”‚
â”‚   â””â”€â”€ types/
â”‚       â””â”€â”€ index.ts                   (TypeScript types)
â”‚
â”œâ”€â”€ index.html
â”œâ”€â”€ vite.config.ts
â”œâ”€â”€ tsconfig.json
â””â”€â”€ package.json
    â”œâ”€â”€ dependencies: react@18.2.0, react-router-dom@7.9.5
    â”œâ”€â”€ devDependencies: vite@5.0.0, typescript@5.3.3
    â””â”€â”€ scripts: dev, build, preview
```

#### Type Definitions (shared/)

```
Monolit-Planner/shared/
â””â”€â”€ src/
    â”œâ”€â”€ types/
    â”‚   â”œâ”€â”€ api.ts           (API request/response types)
    â”‚   â”œâ”€â”€ position.ts      (Position entity)
    â”‚   â”œâ”€â”€ bridge.ts        (Bridge entity)
    â”‚   â”œâ”€â”€ kpi.ts           (KPI calculations)
    â”‚   â”œâ”€â”€ snapshot.ts      (Version control)
    â”‚   â”œâ”€â”€ otskp.ts         (Pricing codes)
    â”‚   â”œâ”€â”€ sheathing.ts     (Formwork types)
    â”‚   â””â”€â”€ user.ts          (User/Auth types)
    â”‚
    â””â”€â”€ index.ts             (Export all types)
```

---

### 2. STAVAGENT-PORTAL

**ĞĞ°Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ:** Ğ¦ĞµĞ½Ñ‚Ñ€Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ¿Ğ¾Ñ€Ñ‚Ğ°Ğ» ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ°Ğ¼Ğ¸

#### Backend Structure

```
stavagent-portal/backend/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ server.js                      (Entry point)
â”‚   â”‚
â”‚   â”œâ”€â”€ routes/
â”‚   â”‚   â”œâ”€â”€ auth.js                    (100% identical to Monolit!)
â”‚   â”‚   â”œâ”€â”€ admin.js                   (100% identical to Monolit!)
â”‚   â”‚   â”œâ”€â”€ otskp.js                   (100% identical to Monolit!)
â”‚   â”‚   â”œâ”€â”€ portal-projects.js         (Portal-specific projects)
â”‚   â”‚   â”œâ”€â”€ portal-files.js            (Portal file management)
â”‚   â”‚   â”œâ”€â”€ kiosk-links.js             (Kiosk integration)
â”‚   â”‚   â””â”€â”€ debug.js                   (Debug endpoints)
â”‚   â”‚
â”‚   â””â”€â”€ [same structure as Monolit]
â”‚
â”œâ”€â”€ package.json
â”œâ”€â”€ .env.example
â”‚   â”œâ”€â”€ NODE_ENV=production
â”‚   â”œâ”€â”€ PORT=3001
â”‚   â”œâ”€â”€ DB_PATH=./data/stavagent-portal.db
â”‚   â”œâ”€â”€ CORE_API_URL=https://concrete-agent.onrender.com
â”‚   â””â”€â”€ JWT_SECRET=...
â”‚
â””â”€â”€ [same middleware, models, services as Monolit]
```

#### Frontend Structure

```
stavagent-portal/frontend/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ main.tsx
â”‚   â”œâ”€â”€ App.tsx
â”‚   â”‚
â”‚   â”œâ”€â”€ pages/
â”‚   â”‚   â”œâ”€â”€ LoginPage.tsx
â”‚   â”‚   â”œâ”€â”€ DashboardPage.tsx
â”‚   â”‚   â”œâ”€â”€ ProjectsPage.tsx          (Portal-specific)
â”‚   â”‚   â”œâ”€â”€ ProjectDetailPage.tsx     (Portal-specific)
â”‚   â”‚   â”œâ”€â”€ DocumentUploadPage.tsx
â”‚   â”‚   â”œâ”€â”€ KioskPage.tsx             (Portal-specific)
â”‚   â”‚   â”œâ”€â”€ AdminPage.tsx
â”‚   â”‚   â””â”€â”€ 404Page.tsx
â”‚   â”‚
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ ProtectedRoute.tsx         (DUPLICATED!)
â”‚   â”‚   â”œâ”€â”€ AnalysisPreview.tsx        (DUPLICATED! 13,238 LOC)
â”‚   â”‚   â”œâ”€â”€ OtskpAutocomplete.tsx      (DUPLICATED! 5,000 LOC)
â”‚   â”‚   â”œâ”€â”€ DocumentUpload.tsx         (DUPLICATED! 6,562 LOC)
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ PortalComponents/
â”‚   â”‚   â”‚   â”œâ”€â”€ ProjectCard.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ ProjectList.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ CreateProjectModal.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ CorePanel.tsx
â”‚   â”‚   â”‚   â””â”€â”€ KioskIntegration.tsx
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ AdminComponents/
â”‚   â”‚       â”œâ”€â”€ UserManagement.tsx
â”‚   â”‚       â”œâ”€â”€ AuditLogs.tsx
â”‚   â”‚       â””â”€â”€ SystemStats.tsx
â”‚   â”‚
â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â””â”€â”€ api.ts                     (99% identical to Monolit!)
â”‚   â”‚
â”‚   â”œâ”€â”€ context/
â”‚   â”‚   â””â”€â”€ AuthContext.tsx            (100% identical to Monolit!)
â”‚   â”‚
â”‚   â”œâ”€â”€ hooks/
â”‚   â”‚   â”œâ”€â”€ useAuth.ts                 (Identical!)
â”‚   â”‚   â””â”€â”€ [same as Monolit]
â”‚   â”‚
â”‚   â””â”€â”€ [same structure as Monolit frontend]
â”‚
â””â”€â”€ package.json
    â””â”€â”€ [same dependencies as Monolit]
```

---

### 3. CONCRETE-AGENT (Ğ¯Ğ”Ğ Ğ Ğ¡Ğ˜Ğ¡Ğ¢Ğ•ĞœĞ«)

**Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ:** âœ… Ğ¯Ğ”Ğ Ğ Ğ¡Ğ˜Ğ¡Ğ¢Ğ•ĞœĞ« - ĞšĞ Ğ˜Ğ¢Ğ˜Ğ§ĞĞ«Ğ™ Ğ˜ Ğ ĞĞ‘ĞĞ§Ğ˜Ğ™

```
concrete-agent/
â”œâ”€â”€ packages/
â”‚   â”œâ”€â”€ core-backend/                  (FastAPI + Python) âœ… Ğ ĞĞ‘ĞĞ¢ĞĞ•Ğ¢
â”‚   â”‚   â”œâ”€â”€ app/
â”‚   â”‚   â”‚   â”œâ”€â”€ main.py                (FastAPI Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ğµ)
â”‚   â”‚   â”‚   â”œâ”€â”€ models/                (SQLAlchemy models)
â”‚   â”‚   â”‚   â”œâ”€â”€ routes/                (REST endpoints)
â”‚   â”‚   â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ parsing_service.py (ĞŸĞ°Ñ€ÑĞ¸Ğ½Ğ³ MinerU)
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ enrichment.py      (ML Ğ¾Ğ±Ğ¾Ğ³Ğ°Ñ‰ĞµĞ½Ğ¸Ğµ)
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ claude_service.py  (Anthropic Claude API)
â”‚   â”‚   â”‚   â””â”€â”€ prompts/               (AI Ğ¿Ñ€Ğ¾Ğ¼Ğ¿Ñ‚Ñ‹)
â”‚   â”‚   â”œâ”€â”€ requirements.txt           (MinerU, Claude, FastAPI, etc)
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚
â”‚   â”œâ”€â”€ core-frontend/                 (Vite + React 18)
â”‚   â”‚   â””â”€â”€ [ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ñ‹ Ğ´Ğ»Ñ Ğ²Ğ¸Ğ·ÑƒĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸]
â”‚   â”‚
â”‚   â””â”€â”€ core-shared/                   (TypeScript types)
â”‚       â””â”€â”€ [API contracts]
â”‚
â””â”€â”€ frontend/                          (Next.js wrapper)
    â””â”€â”€ [Ğ½Ğµ ĞºÑ€Ğ¸Ñ‚Ğ¸Ñ‡Ğ½Ğ¾ - Ğ½Ğµ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ÑÑ]
```

**Ğ¯Ğ”Ğ Ğ Ğ¡Ğ˜Ğ¡Ğ¢Ğ•ĞœĞ« - ĞĞ§Ğ•ĞĞ¬ Ğ’ĞĞ–ĞĞ:**
- âœ… Ğ­Ñ‚Ğ¾ Ğ¿Ğ°Ñ€ÑĞµÑ€Ñ‹ Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ¾Ğ² (MinerU)
- âœ… Ğ­Ñ‚Ğ¾ Ğ˜Ğ˜ Ğ»Ğ¾Ğ³Ğ¸ĞºĞ° (Anthropic Claude)
- âœ… Ğ­Ñ‚Ğ¾ Ğ¾Ğ±Ğ¾Ğ³Ğ°Ñ‰ĞµĞ½Ğ¸Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… (enrichment)
- âœ… REST API Ğ´Ğ»Ñ Ğ´Ñ€ÑƒĞ³Ğ¸Ñ… ÑĞµÑ€Ğ²Ğ¸ÑĞ¾Ğ²
- âœ… ĞŸĞ¾Ğ»Ğ½Ğ¾ÑÑ‚ÑŒÑ Ñ€Ğ°Ğ±Ğ¾Ñ‡Ğ¸Ğ¹ Ğ¸ ĞºÑ€Ğ¸Ñ‚Ğ¸Ñ‡Ğ½Ñ‹Ğ¹!

---

## ğŸ—„ï¸ Ğ”ĞĞĞĞ«Ğ• Ğ˜ Ğ‘ĞĞ—Ğ« Ğ”ĞĞĞĞ«Ğ¥

### Ğ¢ĞµĞºÑƒÑ‰Ğ°Ñ Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ° (v1.0)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        Monolit-Planner Backend          â”‚
â”‚        (Express + SQLite)               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  SQLite Database: ./data/monolit.db    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Tables:                                 â”‚
â”‚ â€¢ users                                 â”‚
â”‚ â€¢ projects                              â”‚
â”‚ â€¢ positions                             â”‚
â”‚ â€¢ bridges                               â”‚
â”‚ â€¢ snapshots (version control)           â”‚
â”‚ â€¢ uploads (file metadata)               â”‚
â”‚ â€¢ otskp_codes (pricing)                 â”‚
â”‚ â€¢ audit_logs                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      stavagent-portal Backend           â”‚
â”‚        (Express + SQLite)               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  SQLite Database: ./data/portal.db      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Tables:                                 â”‚
â”‚ â€¢ users                                 â”‚
â”‚ â€¢ projects                              â”‚
â”‚ â€¢ documents (file uploads)              â”‚
â”‚ â€¢ kiosk_sessions                        â”‚
â”‚ â€¢ integrations (CORE API)               â”‚
â”‚ â€¢ audit_logs                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Ğ‘ÑƒĞ´ÑƒÑ‰Ğ°Ñ Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ° (v2.0 - Phase 4)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         PostgreSQL Database             â”‚
â”‚         (Shared across all projects)    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Schemas:                                â”‚
â”‚ â€¢ public (shared)                       â”‚
â”‚   - users                               â”‚
â”‚   - projects                            â”‚
â”‚   - audit_logs                          â”‚
â”‚                                         â”‚
â”‚ â€¢ monolit (Monolit-Planner specific)   â”‚
â”‚   - positions                           â”‚
â”‚   - bridges                             â”‚
â”‚   - snapshots                           â”‚
â”‚                                         â”‚
â”‚ â€¢ portal (Portal specific)              â”‚
â”‚   - kiosk_sessions                      â”‚
â”‚   - integrations                        â”‚
â”‚                                         â”‚
â”‚ â€¢ shared (shared calculations)          â”‚
â”‚   - otskp_codes                         â”‚
â”‚   - materials                           â”‚
â”‚   - standards                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ” ĞĞ£Ğ¢Ğ•ĞĞ¢Ğ˜Ğ¤Ğ˜ĞšĞĞ¦Ğ˜Ğ¯ Ğ˜ ĞĞ’Ğ¢ĞĞ Ğ˜Ğ—ĞĞ¦Ğ˜Ğ¯

### Current Implementation (v1.0)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         CLIENT (Browser)                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â”‚ POST /api/auth/verify
                    â”‚ { username, password }
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      Backend Server (Express)           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1. Validate credentials                 â”‚
â”‚ 2. Hash password with bcrypt            â”‚
â”‚ 3. Generate JWT token                   â”‚
â”‚ 4. Return token                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â”‚ JWT token stored in localStorage
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      Frontend (React)                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Store token: localStorage               â”‚
â”‚ Include in requests:                    â”‚
â”‚   Authorization: Bearer <token>         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â”‚ Each request includes token
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Backend Auth Middleware              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1. Extract token from header            â”‚
â”‚ 2. Verify JWT signature                 â”‚
â”‚ 3. Check expiration                     â”‚
â”‚ 4. Attach user to request               â”‚
â”‚ 5. If 401: redirect to /login           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### JWT Token Structure

```
header.payload.signature

payload = {
  "sub": "user_id",
  "username": "username",
  "role": "admin|user",
  "iat": 1700000000,
  "exp": 1700086400,
  "iss": "STAVAGENT"
}
```

### Protected Routes

```typescript
// Frontend
<ProtectedRoute
  requiredRole="admin"
  fallback={<LoginPage />}
>
  <AdminDashboard />
</ProtectedRoute>

// Backend
app.use('/api/admin', authenticateToken, authorizeRole('admin'))
```

---

## ğŸ”— Ğ˜ĞĞ¢Ğ•Ğ“Ğ ĞĞ¦Ğ˜Ğ¯ ĞœĞ•Ğ–Ğ”Ğ£ Ğ¡Ğ•Ğ Ğ’Ğ˜Ğ¡ĞĞœĞ˜

### Ğ¢ĞµĞºÑƒÑ‰Ğ°Ñ Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ° (v1.0)

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  stavagent-portal   â”‚
                    â”‚     FRONTEND        â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                    â”‚
                    â†“                    â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  Portal BACKEND  â”‚  â”‚ Monolit BACKEND  â”‚
        â”‚  (API routes)    â”‚  â”‚  (API routes)    â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚                    â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                    â”‚
                    â†“                    â†“
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚  Portal DB   â”‚     â”‚  Monolit DB  â”‚
            â”‚ (SQLite)     â”‚     â”‚  (SQLite)    â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Endpoints:
- GET  /api/positions              (from Monolit)
- POST /api/projects               (to Portal)
- GET  /api/projects/{id}/analysis (via Portal â†’ Monolit)
```

### ĞŸĞ»Ğ°Ğ½Ğ¸Ñ€ÑƒĞµĞ¼Ğ°Ñ Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ° (v2.0)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Unified Shared Types   â”‚
â”‚  (@stavagent/shared)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â–²                    â–²                    â–²
         â”‚                    â”‚                    â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Monolit Frontend    â”‚ â”‚ Portal Frontend     â”‚ â”‚ Future Projects  â”‚
â”‚                     â”‚ â”‚                     â”‚ â”‚                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                    â”‚                    â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚                    â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”
         â”‚              â”‚    â”‚              â”‚
         â†“              â†“    â†“              â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Monolit â”‚     â”‚ Portal  â”‚
    â”‚ Backend â”‚     â”‚ Backend â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚              â”‚
         â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”
         â”‚              â”‚
         â†“              â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚PostgreSQLâ”‚   â”‚  Redis   â”‚
    â”‚  (Shared)â”‚   â”‚ (Cache)  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“¡ API CONTRACT ĞœĞ•Ğ–Ğ”Ğ£ Ğ¡Ğ•Ğ Ğ’Ğ˜Ğ¡ĞĞœĞ˜

### Shared Endpoints (Identical in both backends)

```
Authentication:
  POST   /api/auth/verify              { username, password }
  POST   /api/auth/me                  (get current user)
  POST   /api/auth/change-password     { oldPassword, newPassword }
  POST   /api/auth/logout              (clear session)

OTSKP (Pricing Catalog):
  GET    /api/otskp/search?q=...      (search codes)
  GET    /api/otskp/{code}            (get code details)
  GET    /api/otskp/categories        (list categories)

Admin:
  GET    /api/admin/users             (list users)
  POST   /api/admin/users             (create user)
  PUT    /api/admin/users/{id}        (update user)
  DELETE /api/admin/users/{id}        (delete user)
  GET    /api/admin/logs              (audit logs)
```

### Monolit-Specific Endpoints

```
Positions:
  GET    /api/positions
  POST   /api/positions               { name, type, config }
  PUT    /api/positions/{id}
  DELETE /api/positions/{id}

Bridges:
  GET    /api/bridges
  POST   /api/bridges                 { name, positions }
  GET    /api/bridges/{id}
  PUT    /api/bridges/{id}
  DELETE /api/bridges/{id}

Analysis:
  POST   /api/bridges/{id}/analyze    (calculate results)
  GET    /api/bridges/{id}/analysis   (get results)

Snapshots:
  GET    /api/bridges/{id}/snapshots  (version history)
  POST   /api/bridges/{id}/snapshots  (save version)

Export:
  POST   /api/bridges/{id}/export     { format: 'excel' | 'pdf' }
```

### Portal-Specific Endpoints

```
Projects:
  GET    /api/projects
  POST   /api/projects                { name, description }
  GET    /api/projects/{id}
  PUT    /api/projects/{id}
  DELETE /api/projects/{id}

Files:
  POST   /api/files/upload            (multipart)
  GET    /api/files/{id}              (download)
  DELETE /api/files/{id}

Kiosk:
  POST   /api/kiosk/start-session     { sessionData }
  GET    /api/kiosk/session/{id}
  POST   /api/kiosk/session/{id}/end

Integrations:
  GET    /api/integrations            (configured services)
  POST   /api/integrations/core       (sync with CORE)
```

---

## ğŸš€ DEPLOYMENT ARCHITECTURE

### Current (Render.com)

```
GitHub (alpro1000/STAVAGENT)
         â”‚
         â”‚ git push origin main
         â”‚
         â†“
    Render Dashboard
         â”‚
    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚          â”‚         â”‚
    â†“          â†“         â†“
[Service 1] [Service 2] [Service 3]
â”‚            â”‚           â”‚
â”œâ”€ Name: monolit-planner-api
â”œâ”€ Root: Monolit-Planner/
â”œâ”€ Build: npm install
â”œâ”€ Start: npm start
â”œâ”€ URL: https://monolit-planner-api.onrender.com
â”‚
â”‚
â”œâ”€ Name: stavagent-portal-backend
â”œâ”€ Root: stavagent-portal/
â”œâ”€ Build: npm install
â”œâ”€ Start: npm start
â”œâ”€ URL: https://stavagent-portal-backend.onrender.com
â”‚
â”‚
â””â”€ OLD: monolit-planner-frontend (deprecated)
   â””â”€ Should be removed
```

### Future (v2.0 - Kubernetes)

```
STAVAGENT Cluster
â”œâ”€â”€ Namespace: monolit
â”‚   â”œâ”€â”€ Pod: monolit-backend
â”‚   â”œâ”€â”€ Pod: monolit-frontend
â”‚   â”œâ”€â”€ Service: monolit-api (LoadBalancer)
â”‚   â””â”€â”€ PersistentVolume: monolit-data
â”‚
â”œâ”€â”€ Namespace: portal
â”‚   â”œâ”€â”€ Pod: portal-backend
â”‚   â”œâ”€â”€ Pod: portal-frontend
â”‚   â”œâ”€â”€ Service: portal-api (LoadBalancer)
â”‚   â””â”€â”€ PersistentVolume: portal-data
â”‚
â”œâ”€â”€ Namespace: shared
â”‚   â”œâ”€â”€ Pod: postgres-db
â”‚   â”œâ”€â”€ Pod: redis-cache
â”‚   â”œâ”€â”€ Service: postgres-service (ClusterIP)
â”‚   â””â”€â”€ Service: redis-service (ClusterIP)
â”‚
â””â”€â”€ Ingress: API Gateway
    â”œâ”€â”€ api.stavagent.io/monolit â†’ monolit-api
    â”œâ”€â”€ api.stavagent.io/portal â†’ portal-api
    â””â”€â”€ api.stavagent.io/health â†’ health-check
```

---

## ğŸ”„ DATA FLOW: Ğ˜Ğ¡ĞŸĞĞ›Ğ¬Ğ—ĞĞ’ĞĞĞ˜Ğ• Ğ¡Ğ›Ğ£Ğ§ĞĞ™

### Use Case 1: ĞĞ²Ñ‚Ğ¾Ñ€Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ

```
1. User opens https://monolit-planner-api.onrender.com
2. Frontend (Vite) loads React app
3. User enters credentials
4. Frontend: POST /api/auth/verify { username, password }
5. Backend:
   - Lookup user in SQLite
   - Verify password hash with bcrypt
   - Generate JWT token
   - Return { token, user: { id, username, role } }
6. Frontend: localStorage.setItem('token', response.token)
7. Frontend: Redirect to /dashboard
8. Frontend: Include Authorization header in all requests
9. Backend: Middleware verifies JWT on each request
10. If token expired: Frontend redirects to /login
```

### Use Case 2: Ğ Ğ°ÑÑ‡Ñ‘Ñ‚ Ğ¼Ğ¾ÑÑ‚Ğ°

```
1. User navigates to /bridges/123 in Monolit-Planner frontend
2. Frontend: GET /api/bridges/123
3. Backend: Query SQLite, return bridge data
4. User modifies positions, clicks "Calculate"
5. Frontend: POST /api/bridges/123/analyze { positions }
6. Backend:
   - Run calculation service
   - Update database
   - Return { success, analysis: { kpi, results } }
7. Frontend: Display AnalysisPreview component with results
8. User clicks "Export"
9. Frontend: POST /api/bridges/123/export { format: 'excel' }
10. Backend:
    - Generate Excel file
    - Save to uploads/
    - Return { downloadUrl }
11. Frontend: Trigger browser download
```

### Use Case 3: Ğ—Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ° Ğ² Portal

```
1. User navigates to /upload in stavagent-portal
2. User selects Excel file
3. Frontend: POST /api/files/upload (multipart/form-data)
4. Backend:
   - Validate file type
   - Save to uploads/
   - Extract metadata
   - Store in SQLite
5. Backend: POST to Monolit API?
   (optional integration)
6. Frontend: Show "Upload successful"
7. User can now use document for analysis
```

---

## ğŸ“ KEY ARCHITECTURAL PRINCIPLES

### 1. **Separation of Concerns**
- Each service has own database
- Each service owns its routes
- Clean API boundaries

### 2. **Frontend Reusability**
- Shared components go in packages/ (Phase 2)
- Each project imports from shared
- Reduces duplication

### 3. **Backend Consolidation**
- Common auth logic â†’ packages/auth-routes
- Common admin logic â†’ packages/admin-routes
- Project-specific logic stays in service

### 4. **Type Safety**
- TypeScript across all frontends
- Shared types in @stavagent/shared-types
- Backend models match frontend types

### 5. **Monorepo Benefits**
- Single git repository
- Shared development workflow
- Consistent tooling
- Easy refactoring across services

---

## âš¡ PERFORMANCE CONSIDERATIONS

### Current Optimizations

```
Frontend:
âœ… Vite (fast build)
âœ… React 18 (automatic batching)
âœ… React Query (caching)
âœ… Code splitting (lazy routes)

Backend:
âœ… SQLite (fast for single-user)
âœ… JWT stateless auth
âœ… Express middleware chain
âœ… Connection pooling
```

### Future Optimizations (Phase 3-4)

```
Frontend:
- Add Zustand (better state management)
- Implement Tailwind CSS (smaller CSS)
- Add service worker (offline support)

Backend:
- PostgreSQL (concurrent users)
- Redis caching (frequently accessed data)
- Message queue (async operations)
- Database indexing (query optimization)
- API rate limiting (protection)
```

---

## ğŸ“Š SCALABILITY ROADMAP

### Phase 1 (Current): âœ… DONE
- Monorepo consolidation
- Both services on Render

### Phase 2 (Dec 2024): ğŸ”„ IN PROGRESS
- Extract shared packages
- Reduce code duplication
- Standardize UI components

### Phase 3 (Jan 2025): â³ UPCOMING
- Unified styling (Tailwind)
- Unified state management (Zustand)
- Database unification (PostgreSQL)

### Phase 4 (Q1 2025): â³ FUTURE
- Kubernetes deployment
- Microservices architecture
- Distributed caching (Redis)
- Message queue (Celery/RabbitMQ)

---

**Last Updated:** 2024-11-21
**Next Review:** 2024-12-01
