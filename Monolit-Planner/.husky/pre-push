#!/bin/sh
# Husky pre-push hook - Final checks before push

echo "ğŸš€ Running pre-push checks..."

# Check branch name (Ğ´Ğ¾Ğ»Ğ¶ĞµĞ½ Ğ½Ğ°Ñ‡Ğ¸Ğ½Ğ°Ñ‚ÑŒÑÑ Ñ claude/ Ğ¸ Ğ·Ğ°ĞºĞ°Ğ½Ñ‡Ğ¸Ğ²Ğ°Ñ‚ÑŒÑÑ session ID)
BRANCH=$(git branch --show-current)
echo "ğŸ“ Current branch: $BRANCH"

if [[ ! $BRANCH =~ ^claude/.+-[a-zA-Z0-9]{5}$ ]]; then
  echo "âš ï¸  Warning: Branch name doesn't match pattern 'claude/*-xxxxx'"
  echo "   Current: $BRANCH"
  echo "   Expected: claude/feature-name-abcde"
fi

# Run full test suite one more time
echo "ğŸ§ª Running full test suite..."
cd Monolit-Planner/shared && npm test
if [ $? -ne 0 ]; then
  echo "âŒ Shared tests failed!"
  exit 1
fi

echo "âœ… All pre-push checks passed!"
exit 0
