# STAVAGENT Unification Plan

> **Ğ¦ĞµĞ»ÑŒ:** ĞĞ±ÑŠĞµĞ´Ğ¸Ğ½Ğ¸Ñ‚ÑŒ Ğ²ÑĞµ kiosks Ğ² ĞµĞ´Ğ¸Ğ½ÑƒÑ ÑĞºĞ¾ÑĞ¸ÑÑ‚ĞµĞ¼Ñƒ Ñ Ğ²Ğ·Ğ°Ğ¸Ğ¼Ğ¾ÑĞ²ÑĞ·Ğ°Ğ½Ğ½Ñ‹Ğ¼Ğ¸ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğ¼Ğ¸

**Ğ’ĞµÑ€ÑĞ¸Ñ:** 1.0.0
**Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¾:** 2026-02-04
**Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ:** Ğ’ Ñ€Ğ°Ğ·Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞµ

---

## Ğ¡Ğ¾Ğ´ĞµÑ€Ğ¶Ğ°Ğ½Ğ¸Ğµ

1. [ĞĞ±Ğ·Ğ¾Ñ€ Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ñ‹](#1-Ğ¾Ğ±Ğ·Ğ¾Ñ€-Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ñ‹)
2. [Ğ¢ĞµĞºÑƒÑ‰ĞµĞµ ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğµ](#2-Ñ‚ĞµĞºÑƒÑ‰ĞµĞµ-ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğµ)
3. [Ğ¦ĞµĞ»ĞµĞ²Ğ°Ñ Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ°](#3-Ñ†ĞµĞ»ĞµĞ²Ğ°Ñ-Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ°)
4. [Ğ£Ğ½Ğ¸Ñ„Ğ¸Ñ†Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ğ°Ñ Ğ¼Ğ¾Ğ´ĞµĞ»ÑŒ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…](#4-ÑƒĞ½Ğ¸Ñ„Ğ¸Ñ†Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ğ°Ñ-Ğ¼Ğ¾Ğ´ĞµĞ»ÑŒ-Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…)
5. [Ğ¤Ğ°Ğ·Ñ‹ Ñ€ĞµĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸](#5-Ñ„Ğ°Ğ·Ñ‹-Ñ€ĞµĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸)
6. [API ĞºĞ¾Ğ½Ñ‚Ñ€Ğ°ĞºÑ‚Ñ‹](#6-api-ĞºĞ¾Ğ½Ñ‚Ñ€Ğ°ĞºÑ‚Ñ‹)
7. [TOV (Ğ’ĞµĞ´Ğ¾Ğ¼Ğ¾ÑÑ‚ÑŒ Ñ€ĞµÑÑƒÑ€ÑĞ¾Ğ²)](#7-tov-Ğ²ĞµĞ´Ğ¾Ğ¼Ğ¾ÑÑ‚ÑŒ-Ñ€ĞµÑÑƒÑ€ÑĞ¾Ğ²)
8. [Ğ§ĞµĞºĞ»Ğ¸ÑÑ‚ Ğ·Ğ°Ğ´Ğ°Ñ‡](#8-Ñ‡ĞµĞºĞ»Ğ¸ÑÑ‚-Ğ·Ğ°Ğ´Ğ°Ñ‡)

---

## 1. ĞĞ±Ğ·Ğ¾Ñ€ Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ñ‹

### ĞŸÑ€Ğ¸Ğ½Ñ†Ğ¸Ğ¿ "Ğ›ÑĞ±Ğ°Ñ Ñ‚Ğ¾Ñ‡ĞºĞ° Ğ²Ñ…Ğ¾Ğ´Ğ°"

ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ Ğ¼Ğ¾Ğ¶ĞµÑ‚ Ğ½Ğ°Ñ‡Ğ°Ñ‚ÑŒ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñƒ Ñ Ğ»ÑĞ±Ğ¾Ğ³Ğ¾ Ğ¼ĞµÑÑ‚Ğ°:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Ğ¢ĞĞ§ĞšĞ˜ Ğ’Ğ¥ĞĞ”Ğ                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  [Excel Ñ„Ğ°Ğ¹Ğ»] â”€â”€â†’ Registry â”€â”€â†’ ĞšĞ»Ğ°ÑÑĞ¸Ñ„Ğ¸ĞºĞ°Ñ†Ğ¸Ñ â”€â”€â†’ TOV â”€â”€â†’ Calc   â”‚
â”‚                                                                  â”‚
â”‚  [PDF/DOCX] â”€â”€â†’ URS Matcher â”€â”€â†’ ĞšĞ¾Ğ´Ñ‹ â”€â”€â†’ Registry â”€â”€â†’ TOV       â”‚
â”‚                                                                  â”‚
â”‚  [ĞšĞ°Ğ»ÑŒĞºÑƒĞ»ÑÑ‚Ğ¾Ñ€] â”€â”€â†’ Monolit â”€â”€â†’ ĞŸĞ¾Ğ·Ğ¸Ñ†Ğ¸Ğ¸ â”€â”€â†’ Registry â”€â”€â†’ ĞÑ‚Ñ‡Ñ‘Ñ‚   â”‚
â”‚                                                                  â”‚
â”‚  [Portal] â”€â”€â†’ Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚ â”€â”€â†’ Ğ¡Ğ²ÑĞ·Ğ°Ñ‚ÑŒ kiosks â”€â”€â†’ ĞĞ³Ñ€ĞµĞ³Ğ°Ñ†Ğ¸Ñ   â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ĞŸÑ€Ğ¸Ğ½Ñ†Ğ¸Ğ¿ "ĞĞµĞ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚ÑŒ + Ğ¡Ğ²ÑĞ·Ğ°Ğ½Ğ½Ğ¾ÑÑ‚ÑŒ"

- ĞšĞ°Ğ¶Ğ´Ñ‹Ğ¹ kiosk Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚ **Ğ°Ğ²Ñ‚Ğ¾Ğ½Ğ¾Ğ¼Ğ½Ğ¾**
- ĞŸÑ€Ğ¸ Ğ½ĞµĞ¾Ğ±Ñ…Ğ¾Ğ´Ğ¸Ğ¼Ğ¾ÑÑ‚Ğ¸ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ **ÑĞ²ÑĞ·Ñ‹Ğ²Ğ°ÑÑ‚ÑÑ** Ñ‡ĞµÑ€ĞµĞ· Portal
- Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ñ‹ **Ğ½Ğ°ĞºĞ°Ğ¿Ğ»Ğ¸Ğ²Ğ°ÑÑ‚ÑÑ** Ğ² Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğµ

---

## 2. Ğ¢ĞµĞºÑƒÑ‰ĞµĞµ ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğµ

### ĞÑƒĞ´Ğ¸Ñ‚ Project ID (Ñ„ĞµĞ²Ñ€Ğ°Ğ»ÑŒ 2026)

| Ğ¡ĞµÑ€Ğ²Ğ¸Ñ | ĞŸĞ¾Ğ»Ğµ ID | Ğ¤Ğ¾Ñ€Ğ¼Ğ°Ñ‚ | Portal ÑĞ²ÑĞ·ÑŒ |
|--------|---------|--------|--------------|
| **Portal** | `portal_project_id` | UUID | âœ… Ğ˜ÑÑ‚Ğ¾Ñ‡Ğ½Ğ¸Ğº |
| **Monolit-Planner** | `project_id` / `bridge_id` | Ğ¡Ñ‚Ñ€Ğ¾ĞºĞ° (SO201) | âš ï¸ Ğ¢Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ° ĞµÑÑ‚ÑŒ |
| **URS_MATCHER** | `jobs.id` | UUID | âœ… ĞŸĞ¾Ğ»Ğµ ĞµÑÑ‚ÑŒ |
| **rozpocet-registry** | `projectId` | UUID | âŒ ĞĞµÑ‚ ÑĞ²ÑĞ·Ğ¸ |
| **concrete-agent** | `project_id` | UUID | âš ï¸ Ğ§ĞµÑ€ĞµĞ· Ñ„Ğ°Ğ¹Ğ»Ñ‹ |

### ĞÑƒĞ´Ğ¸Ñ‚ Position Ğ¿Ğ¾Ğ»ĞµĞ¹

| ĞŸĞ¾Ğ»Ğµ | Monolit | URS | Registry | CORE |
|------|---------|-----|----------|------|
| ĞšĞ¾Ğ´ | `otskp_code` | `urs_code` | `kod` | `code` |
| ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ | `item_name` | `urs_name` | `popis` | `description` |
| ĞšĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾ | `qty` | `quantity` | `mnozstvi` | `quantity` |
| Ğ•Ğ´Ğ¸Ğ½Ğ¸Ñ†Ğ° | `unit` | `unit` | `mj` | `unit` |
| Ğ¦ĞµĞ½Ğ° ĞµĞ´. | `unit_cost_native` | - | `cenaJednotkova` | `unit_price` |
| Ğ¡ÑƒĞ¼Ğ¼Ğ° | `kros_total_czk` | - | `cenaCelkem` | `total_price` |
| Ğ“Ñ€ÑƒĞ¿Ğ¿Ğ° | `subtype` | - | `skupina` | `category` |

---

## 3. Ğ¦ĞµĞ»ĞµĞ²Ğ°Ñ Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         PORTAL (Hub)                             â”‚
â”‚                    portal_project_id = UUID                      â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                    kiosk_links                           â”‚    â”‚
â”‚  â”‚  portal_project_id â”‚ kiosk_type â”‚ kiosk_project_id      â”‚    â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚    â”‚
â”‚  â”‚  abc-123           â”‚ monolit    â”‚ SO201                 â”‚    â”‚
â”‚  â”‚  abc-123           â”‚ urs        â”‚ job-456               â”‚    â”‚
â”‚  â”‚  abc-123           â”‚ registry   â”‚ reg-789               â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â–¼                 â–¼                 â–¼                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   MONOLIT   â”‚    â”‚     URS     â”‚    â”‚  REGISTRY   â”‚    â”‚   FUTURE    â”‚
â”‚   PLANNER   â”‚    â”‚   MATCHER   â”‚    â”‚  ROZPOÄŒTÅ®   â”‚    â”‚   KIOSKS    â”‚
â”‚             â”‚    â”‚             â”‚    â”‚             â”‚    â”‚             â”‚
â”‚ Ğ‘ĞµÑ‚Ğ¾Ğ½       â”‚    â”‚ ĞšĞ¾Ğ´Ñ‹ URS    â”‚    â”‚ ĞŸĞ¾Ğ·Ğ¸Ñ†Ğ¸Ğ¸     â”‚    â”‚ Machinery   â”‚
â”‚ KÄ/mÂ³       â”‚    â”‚ Matching    â”‚    â”‚ Skupiny     â”‚    â”‚ Labor       â”‚
â”‚ ĞĞ¾Ñ€Ğ¼-Ñ‡Ğ°ÑÑ‹   â”‚    â”‚ Extraction  â”‚    â”‚ TOV         â”‚    â”‚ ...         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 4. Ğ£Ğ½Ğ¸Ñ„Ğ¸Ñ†Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ğ°Ñ Ğ¼Ğ¾Ğ´ĞµĞ»ÑŒ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…

### 4.1 UnifiedProject

```typescript
interface UnifiedProject {
  // Ğ˜Ğ´ĞµĞ½Ñ‚Ğ¸Ñ„Ğ¸ĞºĞ°Ñ†Ğ¸Ñ
  portalProjectId: string;        // UUID Ğ¾Ñ‚ Portal (Ğ“Ğ›ĞĞ’ĞĞ«Ğ™ ĞšĞ›Ğ®Ğ§)
  name: string;                   // ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ°
  description?: string;

  // Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ
  status: 'active' | 'completed' | 'archived';
  createdAt: string;              // ISO datetime
  updatedAt: string;

  // Ğ¡Ğ²ÑĞ·Ğ¸ Ñ kiosks
  linkedKiosks: {
    monolit?: string;             // project_id Ğ² Monolit
    urs?: string;                 // job_id Ğ² URS
    registry?: string;            // projectId Ğ² Registry
  };

  // ĞĞ³Ñ€ĞµĞ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ
  summary?: {
    totalPositions: number;
    totalCost: number;
    currency: 'CZK';
  };
}
```

### 4.2 UnifiedPosition

```typescript
interface UnifiedPosition {
  // === Ğ˜Ğ”Ğ•ĞĞ¢Ğ˜Ğ¤Ğ˜ĞšĞĞ¢ĞĞ Ğ« ===
  id: string;                     // UUID Ğ¿Ğ¾Ğ·Ğ¸Ñ†Ğ¸Ğ¸ (ÑƒĞ½Ğ¸ĞºĞ°Ğ»ÑŒĞ½Ñ‹Ğ¹)
  portalProjectId: string;        // Ğ¡Ğ²ÑĞ·ÑŒ Ñ Portal Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ¾Ğ¼
  sourceKiosk: 'monolit' | 'urs' | 'registry' | 'core' | 'manual';
  sourceItemId: string;           // ĞÑ€Ğ¸Ğ³Ğ¸Ğ½Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ ID Ğ² Ğ¸ÑÑ‚Ğ¾Ñ‡Ğ½Ğ¸ĞºĞµ

  // === ĞĞ¡ĞĞĞ’ĞĞ«Ğ• ĞŸĞĞ›Ğ¯ (Ğ•Ğ”Ğ˜ĞĞĞ• Ğ˜ĞœĞ•ĞĞĞ’ĞĞĞ˜Ğ•) ===
  code: string | null;            // ĞšĞ¾Ğ´ Ğ¿Ğ¾Ğ·Ğ¸Ñ†Ğ¸Ğ¸
                                  // â† kod (registry)
                                  // â† urs_code (urs)
                                  // â† otskp_code (monolit)
                                  // â† code (core)

  description: string;            // ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‹
                                  // â† popis (registry)
                                  // â† urs_name (urs)
                                  // â† item_name (monolit)
                                  // â† description (core)

  quantity: number | null;        // ĞšĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾
                                  // â† mnozstvi (registry)
                                  // â† quantity (urs, core)
                                  // â† qty (monolit)

  unit: string | null;            // Ğ•Ğ´Ğ¸Ğ½Ğ¸Ñ†Ğ° Ğ¸Ğ·Ğ¼ĞµÑ€ĞµĞ½Ğ¸Ñ
                                  // â† mj (registry)
                                  // â† unit (Ğ²ÑĞµ Ğ¾ÑÑ‚Ğ°Ğ»ÑŒĞ½Ñ‹Ğµ)

  unitPrice: number | null;       // Ğ¦ĞµĞ½Ğ° Ğ·Ğ° ĞµĞ´Ğ¸Ğ½Ğ¸Ñ†Ñƒ
                                  // â† cenaJednotkova (registry)
                                  // â† unit_cost_native (monolit)
                                  // â† unit_price (core)

  totalPrice: number | null;      // ĞĞ±Ñ‰Ğ°Ñ ÑÑƒĞ¼Ğ¼Ğ°
                                  // â† cenaCelkem (registry)
                                  // â† kros_total_czk (monolit)
                                  // â† total_price (core)

  // === ĞšĞ›ĞĞ¡Ğ¡Ğ˜Ğ¤Ğ˜ĞšĞĞ¦Ğ˜Ğ¯ ===
  category: string | null;        // Ğ“Ñ€ÑƒĞ¿Ğ¿Ğ°/Ñ‚Ğ¸Ğ¿ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‹
                                  // â† skupina (registry)
                                  // â† subtype (monolit)
                                  // â† category (core)

  rowRole: 'main' | 'section' | 'subordinate' | 'unknown';

  // === ĞšĞĞ§Ğ•Ğ¡Ğ¢Ğ’Ğ Ğ”ĞĞĞĞ«Ğ¥ ===
  confidence: number | null;      // 0-100, ÑƒĞ²ĞµÑ€ĞµĞ½Ğ½Ğ¾ÑÑ‚ÑŒ ĞºĞ»Ğ°ÑÑĞ¸Ñ„Ğ¸ĞºĞ°Ñ†Ğ¸Ğ¸
  matchSource: string | null;     // ĞÑ‚ĞºÑƒĞ´Ğ° Ğ¿Ğ¾Ğ»ÑƒÑ‡ĞµĞ½ ĞºĞ¾Ğ´ (AI, manual, rule)

  // === TOV (Ğ’Ğ•Ğ”ĞĞœĞĞ¡Ğ¢Ğ¬ Ğ Ğ•Ğ¡Ğ£Ğ Ğ¡ĞĞ’) ===
  tov?: TOVData;

  // === Ğ˜Ğ¡Ğ¢ĞĞ§ĞĞ˜Ğš ===
  source: {
    fileName?: string;
    sheetName?: string;
    rowNumber?: number;
    importedAt: string;
  };

  // === Ğ¡Ğ’Ğ¯Ğ—Ğ˜ ===
  linkedCalculations?: {
    monolitPositionId?: string;   // Ğ¡ÑÑ‹Ğ»ĞºĞ° Ğ½Ğ° Ñ€Ğ°ÑÑ‡Ñ‘Ñ‚ Ğ² Monolit
    ursMatchId?: string;          // Ğ¡ÑÑ‹Ğ»ĞºĞ° Ğ½Ğ° Ğ¼Ğ°Ñ‚Ñ‡ Ğ² URS
  };
}
```

### 4.3 TOVData (Ğ’ĞµĞ´Ğ¾Ğ¼Ğ¾ÑÑ‚ÑŒ Ñ€ĞµÑÑƒÑ€ÑĞ¾Ğ²)

```typescript
interface TOVData {
  // === Ğ¢Ğ Ğ£Ğ”ĞĞ’Ğ«Ğ• Ğ Ğ•Ğ¡Ğ£Ğ Ğ¡Ğ« ===
  labor: LaborResource[];
  laborSummary: {
    totalNormHours: number;       // Ğ¡ÑƒĞ¼Ğ¼Ğ° Ğ½Ğ¾Ñ€Ğ¼-Ñ‡Ğ°ÑĞ¾Ğ²
    totalWorkers: number;         // Ğ’ÑĞµĞ³Ğ¾ Ñ€Ğ°Ğ±Ğ¾Ñ‡Ğ¸Ñ…
  };

  // === ĞœĞ•Ğ¥ĞĞĞ˜Ğ—ĞœĞ« ===
  machinery: MachineryResource[];
  machinerySummary: {
    totalMachineHours: number;    // Ğ¡ÑƒĞ¼Ğ¼Ğ° Ğ¼Ğ°ÑˆĞ¸Ğ½Ğ¾-Ñ‡Ğ°ÑĞ¾Ğ²
    totalUnits: number;           // Ğ’ÑĞµĞ³Ğ¾ ĞµĞ´Ğ¸Ğ½Ğ¸Ñ† Ñ‚ĞµÑ…Ğ½Ğ¸ĞºĞ¸
  };

  // === ĞœĞĞ¢Ğ•Ğ Ğ˜ĞĞ›Ğ« ===
  materials: MaterialResource[];
  materialsSummary: {
    totalCost: number;            // Ğ¡ÑƒĞ¼Ğ¼Ğ° ÑÑ‚Ğ¾Ğ¸Ğ¼Ğ¾ÑÑ‚Ğ¸ Ğ¼Ğ°Ñ‚ĞµÑ€Ğ¸Ğ°Ğ»Ğ¾Ğ²
    itemCount: number;            // ĞšĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾ Ğ½Ğ°Ğ¸Ğ¼ĞµĞ½Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğ¹
  };
}

interface LaborResource {
  id: string;
  profession: string;             // Ğ±ĞµÑ‚Ğ¾Ğ½Ñ‰Ğ¸Ğº, Ğ°Ñ€Ğ¼Ğ°Ñ‚ÑƒÑ€Ñ‰Ğ¸Ğº, Ğ¾Ğ¿Ğ°Ğ»ÑƒĞ±Ñ‰Ğ¸Ğº
  professionCode?: string;        // ĞšĞ¾Ğ´ Ğ¿Ñ€Ğ¾Ñ„ĞµÑÑĞ¸Ğ¸
  count: number;                  // ĞšĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾ Ñ€Ğ°Ğ±Ğ¾Ñ‡Ğ¸Ñ…
  hours: number;                  // Ğ§Ğ°ÑÑ‹ Ğ½Ğ° ĞµĞ´Ğ¸Ğ½Ğ¸Ñ†Ñƒ
  normHours: number;              // count Ã— hours = Ğ½Ğ¾Ñ€Ğ¼-Ñ‡Ğ°ÑÑ‹
  hourlyRate?: number;            // Ğ¡Ñ‚Ğ°Ğ²ĞºĞ° KÄ/Ñ‡Ğ°Ñ
  totalCost?: number;             // normHours Ã— hourlyRate
  linkedCalcId?: string;          // Ğ¡ÑÑ‹Ğ»ĞºĞ° Ğ½Ğ° ĞºĞ°Ğ»ÑŒĞºÑƒĞ»ÑÑ‚Ğ¾Ñ€ (Ğ±ÑƒĞ´ÑƒÑ‰ĞµĞµ)
}

interface MachineryResource {
  id: string;
  type: string;                   // Ğ°Ğ²Ñ‚Ğ¾Ğ±ĞµÑ‚Ğ¾Ğ½Ğ¾Ğ½Ğ°ÑĞ¾Ñ, ĞºÑ€Ğ°Ğ½, Ğ²Ğ¸Ğ±Ñ€Ğ°Ñ‚Ğ¾Ñ€
  typeCode?: string;              // ĞšĞ¾Ğ´ Ñ‚ĞµÑ…Ğ½Ğ¸ĞºĞ¸
  count: number;                  // ĞšĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾ ĞµĞ´Ğ¸Ğ½Ğ¸Ñ†
  hours: number;                  // Ğ§Ğ°ÑÑ‹ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‹
  machineHours: number;           // count Ã— hours = Ğ¼Ğ°ÑˆĞ¸Ğ½Ğ¾-Ñ‡Ğ°ÑÑ‹
  hourlyRate?: number;            // Ğ¡Ñ‚Ğ°Ğ²ĞºĞ° KÄ/Ñ‡Ğ°Ñ
  totalCost?: number;
  linkedCalcId?: string;          // Ğ¡ÑÑ‹Ğ»ĞºĞ° Ğ½Ğ° ĞºĞ°Ğ»ÑŒĞºÑƒĞ»ÑÑ‚Ğ¾Ñ€ (Ğ±ÑƒĞ´ÑƒÑ‰ĞµĞµ)
}

interface MaterialResource {
  id: string;
  name: string;                   // Ğ‘ĞµÑ‚Ğ¾Ğ½ C30/37, Ğ°Ñ€Ğ¼Ğ°Ñ‚ÑƒÑ€Ğ° B500B
  code?: string;                  // ĞšĞ¾Ğ´ Ğ¼Ğ°Ñ‚ĞµÑ€Ğ¸Ğ°Ğ»Ğ°
  quantity: number;               // ĞšĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾
  unit: string;                   // mÂ³, kg, ks
  unitPrice?: number;             // Ğ¦ĞµĞ½Ğ° Ğ·Ğ° ĞµĞ´Ğ¸Ğ½Ğ¸Ñ†Ñƒ
  totalCost?: number;             // quantity Ã— unitPrice
  linkedCalcId?: string;          // Ğ¡ÑÑ‹Ğ»ĞºĞ° Ğ½Ğ° Monolit Ğ´Ğ»Ñ Ğ±ĞµÑ‚Ğ¾Ğ½Ğ°
  linkedCalcType?: 'monolit' | 'future_material_calc';
}
```

---

## 5. Ğ¤Ğ°Ğ·Ñ‹ Ñ€ĞµĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸

### Ğ¤Ğ°Ğ·Ğ° 1: Ğ‘Ğ°Ğ·Ğ¾Ğ²Ğ°Ñ ÑĞ²ÑĞ·Ğ½Ğ¾ÑÑ‚ÑŒ (1-2 Ğ½ĞµĞ´ĞµĞ»Ğ¸)

**Ğ¦ĞµĞ»ÑŒ:** Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ `portalProjectId` Ğ²Ğ¾ Ğ²ÑĞµ kiosks

#### 1.1 rozpocet-registry
- [ ] Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ `portalProjectId` Ğ² Ñ‚Ğ¸Ğ¿ `Project`
- [ ] Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ¿Ğ¾Ğ»Ğµ Ğ² `registryStore.ts`
- [ ] UI Ğ´Ğ»Ñ Ğ²Ğ²Ğ¾Ğ´Ğ°/Ğ¾Ñ‚Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ñ Portal ID
- [ ] Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğµ Ğ² localStorage

**Ğ¤Ğ°Ğ¹Ğ»Ñ‹:**
- `src/types/project.ts`
- `src/stores/registryStore.ts`
- `src/components/projects/ProjectHeader.tsx`

#### 1.2 Monolit-Planner
- [ ] Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ `portal_project_id` Ğ² API responses
- [ ] Endpoint Ğ´Ğ»Ñ ÑĞ²ÑĞ·Ñ‹Ğ²Ğ°Ğ½Ğ¸Ñ Ñ Portal
- [ ] UI Ğ¸Ğ½Ğ´Ğ¸ĞºĞ°Ñ‚Ğ¾Ñ€ ÑĞ²ÑĞ·Ğ¸

**Ğ¤Ğ°Ğ¹Ğ»Ñ‹:**
- `backend/src/routes/monolith-projects.js`
- `frontend/src/components/ProjectHeader.tsx`

#### 1.3 URS_MATCHER
- [ ] Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒÑÑ‰ĞµĞµ Ğ¿Ğ¾Ğ»Ğµ `portal_project_id`
- [ ] Endpoint Ğ´Ğ»Ñ ÑĞºÑĞ¿Ğ¾Ñ€Ñ‚Ğ° Ğ² Registry

**Ğ¤Ğ°Ğ¹Ğ»Ñ‹:**
- `backend/src/api/routes/jobs.js`

---

### Ğ¤Ğ°Ğ·Ğ° 2: API ÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸ (2-3 Ğ½ĞµĞ´ĞµĞ»Ğ¸)

**Ğ¦ĞµĞ»ÑŒ:** Ğ”Ğ²ÑƒÑÑ‚Ğ¾Ñ€Ğ¾Ğ½Ğ½Ğ¸Ğ¹ Ğ¾Ğ±Ğ¼ĞµĞ½ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğ¼Ğ¸ Ğ¼ĞµĞ¶Ğ´Ñƒ kiosks

#### 2.1 Registry API (Vercel Serverless)
```
POST /api/sync/import-positions
  Body: { portalProjectId, positions: UnifiedPosition[] }

GET /api/sync/export-positions
  Query: ?portalProjectId=xxx
  Response: UnifiedPosition[]

POST /api/sync/link-portal
  Body: { portalProjectId, registryProjectId }
```

#### 2.2 Portal Aggregation API
```
GET /api/portal-projects/:id/unified
  Response: {
    project: UnifiedProject,
    positions: UnifiedPosition[],
    kiosks: {
      monolit: { status, lastSync, positionCount },
      urs: { status, lastSync, matchCount },
      registry: { status, lastSync, itemCount }
    }
  }
```

#### 2.3 ĞœĞ°Ğ¿Ğ¿Ğ¸Ğ½Ğ³ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¸

ĞšĞ°Ğ¶Ğ´Ñ‹Ğ¹ kiosk Ğ´Ğ¾Ğ»Ğ¶ĞµĞ½ Ğ¸Ğ¼ĞµÑ‚ÑŒ:
```typescript
// Ğ’ ĞºĞ°Ğ¶Ğ´Ğ¾Ğ¼ kiosk
function mapToUnified(localItem: LocalType): UnifiedPosition { }
function mapFromUnified(unified: UnifiedPosition): LocalType { }
```

---

### Ğ¤Ğ°Ğ·Ğ° 3: TOV UI (2-3 Ğ½ĞµĞ´ĞµĞ»Ğ¸)

**Ğ¦ĞµĞ»ÑŒ:** Ğ˜Ğ½Ñ‚ĞµÑ€Ñ„ĞµĞ¹Ñ Ğ´Ğ»Ñ Ğ²ĞµĞ´Ğ¾Ğ¼Ğ¾ÑÑ‚Ğ¸ Ñ€ĞµÑÑƒÑ€ÑĞ¾Ğ² Ğ² Registry

#### 3.1 ĞšĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ñ‹

```
src/components/tov/
â”œâ”€â”€ TOVButton.tsx           # ĞšĞ½Ğ¾Ğ¿ĞºĞ° [ğŸ“Š] Ğ²Ğ¾Ğ·Ğ»Ğµ Ğ¿Ğ¾Ğ·Ğ¸Ñ†Ğ¸Ğ¸
â”œâ”€â”€ TOVModal.tsx            # ĞœĞ¾Ğ´Ğ°Ğ»ÑŒĞ½Ğ¾Ğµ Ğ¾ĞºĞ½Ğ¾
â”œâ”€â”€ TOVTabs.tsx             # Ğ’ĞºĞ»Ğ°Ğ´ĞºĞ¸: Ğ›ÑĞ´Ğ¸ | ĞœĞµÑ…Ğ°Ğ½Ğ¸Ğ·Ğ¼Ñ‹ | ĞœĞ°Ñ‚ĞµÑ€Ğ¸Ğ°Ğ»Ñ‹
â”œâ”€â”€ LaborTab.tsx            # Ğ¢Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ° Ñ‚Ñ€ÑƒĞ´Ğ¾Ğ²Ñ‹Ñ… Ñ€ĞµÑÑƒÑ€ÑĞ¾Ğ²
â”œâ”€â”€ MachineryTab.tsx        # Ğ¢Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ° Ğ¼ĞµÑ…Ğ°Ğ½Ğ¸Ğ·Ğ¼Ğ¾Ğ²
â”œâ”€â”€ MaterialsTab.tsx        # Ğ¢Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ° Ğ¼Ğ°Ñ‚ĞµÑ€Ğ¸Ğ°Ğ»Ğ¾Ğ²
â”œâ”€â”€ ResourceRow.tsx         # Ğ¡Ñ‚Ñ€Ğ¾ĞºĞ° Ñ€ĞµÑÑƒÑ€ÑĞ° (Ñ€ĞµĞ´Ğ°ĞºÑ‚Ğ¸Ñ€ÑƒĞµĞ¼Ğ°Ñ)
â”œâ”€â”€ CalcLink.tsx            # Ğ¡ÑÑ‹Ğ»ĞºĞ° Ğ½Ğ° ĞºĞ°Ğ»ÑŒĞºÑƒĞ»ÑÑ‚Ğ¾Ñ€
â””â”€â”€ TOVSummary.tsx          # Ğ˜Ñ‚Ğ¾Ğ³Ğ¸ Ğ¿Ğ¾ ĞºĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸ÑĞ¼
```

#### 3.2 Store Ñ€Ğ°ÑÑˆĞ¸Ñ€ĞµĞ½Ğ¸Ğµ

```typescript
// Ğ’ registryStore.ts Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ:
interface RegistryState {
  // ... ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒÑÑ‰ĞµĞµ ...

  // TOV Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ
  tovData: Map<string, TOVData>;  // itemId â†’ TOVData

  // TOV actions
  setItemTOV: (itemId: string, tov: TOVData) => void;
  addLaborResource: (itemId: string, resource: LaborResource) => void;
  addMachineryResource: (itemId: string, resource: MachineryResource) => void;
  addMaterialResource: (itemId: string, resource: MaterialResource) => void;
  removeResource: (itemId: string, resourceType: string, resourceId: string) => void;
}
```

#### 3.3 Ğ˜Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ñ Ñ ĞºĞ°Ğ»ÑŒĞºÑƒĞ»ÑÑ‚Ğ¾Ñ€Ğ°Ğ¼Ğ¸

```typescript
// ĞšĞ½Ğ¾Ğ¿ĞºĞ° "Ğ Ğ°ÑÑÑ‡Ğ¸Ñ‚Ğ°Ñ‚ÑŒ Ğ² Monolit"
function openMonolitCalculator(material: MaterialResource) {
  const params = new URLSearchParams({
    portalProjectId: currentProject.portalProjectId,
    returnTo: 'registry',
    material: material.name,
    quantity: material.quantity.toString(),
    unit: material.unit
  });

  window.open(`${MONOLIT_URL}/calculate?${params}`, '_blank');
}
```

---

### Ğ¤Ğ°Ğ·Ğ° 4: Ğ˜Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ñ ĞºĞ°Ğ»ÑŒĞºÑƒĞ»ÑÑ‚Ğ¾Ñ€Ğ¾Ğ² (3-4 Ğ½ĞµĞ´ĞµĞ»Ğ¸)

**Ğ¦ĞµĞ»ÑŒ:** Ğ”Ğ²ÑƒÑÑ‚Ğ¾Ñ€Ğ¾Ğ½Ğ½ÑÑ ÑĞ²ÑĞ·ÑŒ Ñ Monolit Ğ¸ Ğ±ÑƒĞ´ÑƒÑ‰Ğ¸Ğ¼Ğ¸ ĞºĞ°Ğ»ÑŒĞºÑƒĞ»ÑÑ‚Ğ¾Ñ€Ğ°Ğ¼Ğ¸

#### 4.1 Monolit â†’ Registry

```typescript
// Ğ’ Monolit: ĞºĞ½Ğ¾Ğ¿ĞºĞ° "Ğ­ĞºÑĞ¿Ğ¾Ñ€Ñ‚ Ğ² Registry"
async function exportToRegistry(positions: Position[]) {
  const unified = positions.map(mapToUnified);

  await fetch(`${REGISTRY_API}/sync/import-positions`, {
    method: 'POST',
    body: JSON.stringify({
      portalProjectId: currentPortalProjectId,
      positions: unified,
      source: 'monolit'
    })
  });
}
```

#### 4.2 Registry â†’ Monolit

```typescript
// Ğ’ Registry: Ğ¿Ñ€Ğ¸ Ğ¾Ñ‚ĞºÑ€Ñ‹Ñ‚Ğ¸Ğ¸ TOV Ğ¼Ğ°Ñ‚ĞµÑ€Ğ¸Ğ°Ğ»Ğ° "Ğ‘ĞµÑ‚Ğ¾Ğ½"
function calculateInMonolit(material: MaterialResource) {
  // 1. ĞÑ‚ĞºÑ€Ñ‹Ñ‚ÑŒ Monolit Ñ Ğ¿Ğ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ğ°Ğ¼Ğ¸
  // 2. Monolit Ñ€Ğ°ÑÑÑ‡Ğ¸Ñ‚Ñ‹Ğ²Ğ°ĞµÑ‚
  // 3. Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚ Ğ²Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚ÑÑ Ñ‡ĞµÑ€ĞµĞ· postMessage Ğ¸Ğ»Ğ¸ callback URL
}
```

#### 4.3 URS â†’ Registry

```typescript
// Ğ’ URS: Ğ¿Ğ¾ÑĞ»Ğµ Ğ¼Ğ°Ñ‚Ñ‡Ğ¸Ğ½Ğ³Ğ°
async function exportMatchesToRegistry(matches: URSMatch[]) {
  const unified = matches.map(m => ({
    code: m.urs_code,
    description: m.urs_name,
    confidence: m.confidence,
    sourceKiosk: 'urs',
    // ...
  }));

  await fetch(`${REGISTRY_API}/sync/import-positions`, {
    method: 'POST',
    body: JSON.stringify({
      portalProjectId,
      positions: unified,
      source: 'urs'
    })
  });
}
```

---

### Ğ¤Ğ°Ğ·Ğ° 5: Ğ‘ÑƒĞ´ÑƒÑ‰Ğ¸Ğµ ĞºĞ°Ğ»ÑŒĞºÑƒĞ»ÑÑ‚Ğ¾Ñ€Ñ‹ (ongoing)

#### 5.1 Machinery Calculator (ĞšĞ°Ğ»ÑŒĞºÑƒĞ»ÑÑ‚Ğ¾Ñ€ Ñ‚ĞµÑ…Ğ½Ğ¸ĞºĞ¸)
- Ğ Ğ°ÑÑ‡Ñ‘Ñ‚ Ğ¼Ğ°ÑˆĞ¸Ğ½Ğ¾-Ñ‡Ğ°ÑĞ¾Ğ²
- ĞšĞ°Ñ‚Ğ°Ğ»Ğ¾Ğ³ Ñ‚ĞµÑ…Ğ½Ğ¸ĞºĞ¸
- Ğ˜Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ñ Ñ TOV

#### 5.2 Labor Calculator (ĞšĞ°Ğ»ÑŒĞºÑƒĞ»ÑÑ‚Ğ¾Ñ€ Ñ‚Ñ€ÑƒĞ´Ğ¾Ğ·Ğ°Ñ‚Ñ€Ğ°Ñ‚)
- ĞĞ¾Ñ€Ğ¼Ñ‹ Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ¸ Ğ¿Ğ¾ Ğ¿Ñ€Ğ¾Ñ„ĞµÑÑĞ¸ÑĞ¼
- Ğ Ğ°ÑÑ‡Ñ‘Ñ‚ Ğ±Ñ€Ğ¸Ğ³Ğ°Ğ´
- Ğ˜Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ñ Ñ TOV

#### 5.3 Material Calculator (ĞšĞ°Ğ»ÑŒĞºÑƒĞ»ÑÑ‚Ğ¾Ñ€ Ğ¼Ğ°Ñ‚ĞµÑ€Ğ¸Ğ°Ğ»Ğ¾Ğ²)
- Ğ Ğ°ÑÑˆĞ¸Ñ€ĞµĞ½Ğ¸Ğµ Monolit Ğ´Ğ»Ñ Ğ´Ñ€ÑƒĞ³Ğ¸Ñ… Ğ¼Ğ°Ñ‚ĞµÑ€Ğ¸Ğ°Ğ»Ğ¾Ğ²
- ĞšĞ°Ñ‚Ğ°Ğ»Ğ¾Ğ³ Ğ¼Ğ°Ñ‚ĞµÑ€Ğ¸Ğ°Ğ»Ğ¾Ğ²
- Ğ˜Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ñ Ñ TOV

---

## 6. API ĞºĞ¾Ğ½Ñ‚Ñ€Ğ°ĞºÑ‚Ñ‹

### 6.1 Registry Serverless API

**Base URL:** `https://rozpocet-registry.vercel.app/api`

#### Import positions
```http
POST /api/sync/import-positions
Content-Type: application/json
Authorization: Bearer <token>

{
  "portalProjectId": "uuid",
  "positions": [UnifiedPosition],
  "source": "monolit" | "urs" | "core",
  "mergeStrategy": "append" | "replace" | "merge"
}

Response 200:
{
  "success": true,
  "imported": 15,
  "updated": 3,
  "skipped": 0
}
```

#### Export positions
```http
GET /api/sync/export-positions?portalProjectId=uuid&format=unified

Response 200:
{
  "portalProjectId": "uuid",
  "positions": [UnifiedPosition],
  "exportedAt": "ISO datetime"
}
```

#### Link to Portal
```http
POST /api/sync/link-portal
Content-Type: application/json

{
  "portalProjectId": "portal-uuid",
  "registryProjectId": "registry-uuid"
}

Response 200:
{
  "success": true,
  "linked": true
}
```

### 6.2 Inter-Kiosk Communication

```typescript
// Ğ¡Ñ‚Ğ°Ğ½Ğ´Ğ°Ñ€Ñ‚Ğ½Ñ‹Ğ¹ Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ñ Ğ¼ĞµĞ¶Ğ´Ñƒ kiosks
interface KioskMessage {
  type: 'POSITION_EXPORT' | 'CALCULATION_RESULT' | 'SYNC_REQUEST';
  source: KioskType;
  target: KioskType;
  portalProjectId: string;
  payload: any;
  timestamp: string;
}
```

---

## 7. TOV (Ğ’ĞµĞ´Ğ¾Ğ¼Ğ¾ÑÑ‚ÑŒ Ñ€ĞµÑÑƒÑ€ÑĞ¾Ğ²)

### 7.1 UI Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ItemsTable                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ KÃ³d â”‚ Popis              â”‚ MJ  â”‚ Cena    â”‚ Celkem  â”‚ [ğŸ“Š]  â”‚ â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  â”‚ 123 â”‚ BetonÃ¡Å¾ zÃ¡kladÅ¯    â”‚ mÂ³  â”‚ 2500    â”‚ 375000  â”‚ [ğŸ“Š]  â”‚â†â”€â”€ ĞšĞ½Ğ¾Ğ¿ĞºĞ° TOV
â”‚  â””â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                        â”‚
                                                        â–¼ Click
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  TOV Modal                                              [X]     â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•    â”‚
â”‚  PoloÅ¾ka: 123 - BetonÃ¡Å¾ zÃ¡kladÅ¯ (150 mÂ³)                        â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚  â”‚  Ğ›ÑĞ´Ğ¸    â”‚  ĞœĞµÑ…Ğ°Ğ½Ğ¸Ğ·Ğ¼Ñ‹   â”‚  ĞœĞ°Ñ‚ĞµÑ€Ğ¸Ğ°Ğ»Ñ‹   â”‚  â† Tabs             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ Profese      â”‚ PoÄet â”‚ Hodiny â”‚ Normohodiny â”‚ Sazba    â”‚    â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”‚
â”‚  â”‚ BetonÃ¡Å™      â”‚   4   â”‚   8    â”‚     32      â”‚ 398 KÄ/h â”‚    â”‚
â”‚  â”‚ PomocnÃ­k     â”‚   2   â”‚   8    â”‚     16      â”‚ 280 KÄ/h â”‚    â”‚
â”‚  â”‚ [+ PÅ™idat]   â”‚       â”‚        â”‚             â”‚          â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ Celkem normohodin: 48 h                                 â”‚    â”‚
â”‚  â”‚ CelkovÃ© nÃ¡klady prÃ¡ce: 18 944 KÄ                        â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                  â”‚
â”‚  [Kalkulovat v Monolit]  [UloÅ¾it]  [ZruÅ¡it]                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 7.2 ĞšĞ°Ğ»ÑŒĞºÑƒĞ»ÑÑ‚Ğ¾Ñ€Ğ½Ñ‹Ğµ ÑÑÑ‹Ğ»ĞºĞ¸

| Ğ ĞµÑÑƒÑ€Ñ | ĞšĞ°Ğ»ÑŒĞºÑƒĞ»ÑÑ‚Ğ¾Ñ€ | Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ |
|--------|-------------|--------|
| Ğ‘ĞµÑ‚Ğ¾Ğ½ | Monolit-Planner | âœ… Ğ•ÑÑ‚ÑŒ |
| ĞÑ€Ğ¼Ğ°Ñ‚ÑƒÑ€Ğ° | Monolit-Planner | âœ… Ğ•ÑÑ‚ÑŒ |
| ĞĞ¿Ğ°Ğ»ÑƒĞ±ĞºĞ° | Monolit-Planner | âœ… Ğ•ÑÑ‚ÑŒ |
| Ğ¢ĞµÑ…Ğ½Ğ¸ĞºĞ° | Machinery Calculator | â³ Ğ‘ÑƒĞ´ÑƒÑ‰ĞµĞµ |
| Ğ¢Ñ€ÑƒĞ´ | Labor Calculator | â³ Ğ‘ÑƒĞ´ÑƒÑ‰ĞµĞµ |

---

## 8. Ğ§ĞµĞºĞ»Ğ¸ÑÑ‚ Ğ·Ğ°Ğ´Ğ°Ñ‡

### Ğ¤Ğ°Ğ·Ğ° 1: Ğ‘Ğ°Ğ·Ğ¾Ğ²Ğ°Ñ ÑĞ²ÑĞ·Ğ½Ğ¾ÑÑ‚ÑŒ

- [ ] **Registry: portalProjectId**
  - [ ] Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ¿Ğ¾Ğ»Ğµ Ğ² Project type
  - [ ] ĞĞ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ registryStore
  - [ ] UI Ğ´Ğ»Ñ Ğ¾Ñ‚Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ñ
  - [ ] Ğ¢ĞµÑÑ‚Ñ‹

- [ ] **Monolit: Portal link**
  - [ ] API endpoint Ğ´Ğ»Ñ ÑĞ²ÑĞ·Ğ¸
  - [ ] UI Ğ¸Ğ½Ğ´Ğ¸ĞºĞ°Ñ‚Ğ¾Ñ€
  - [ ] Ğ¢ĞµÑÑ‚Ñ‹

- [ ] **URS: Export endpoint**
  - [ ] POST /api/jobs/:id/export-to-registry
  - [ ] ĞœĞ°Ğ¿Ğ¿Ğ¸Ğ½Ğ³ Ğ² UnifiedPosition
  - [ ] Ğ¢ĞµÑÑ‚Ñ‹

### Ğ¤Ğ°Ğ·Ğ° 2: API ÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸

- [ ] **Registry Serverless**
  - [ ] POST /api/sync/import-positions
  - [ ] GET /api/sync/export-positions
  - [ ] POST /api/sync/link-portal
  - [ ] ĞĞ²Ñ‚Ğ¾Ñ€Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ

- [ ] **ĞœĞ°Ğ¿Ğ¿Ğ¸Ğ½Ğ³ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¸**
  - [ ] mapToUnified() Ğ² Registry
  - [ ] mapToUnified() Ğ² Monolit
  - [ ] mapToUnified() Ğ² URS
  - [ ] mapFromUnified() Ğ²ĞµĞ·Ğ´Ğµ

### Ğ¤Ğ°Ğ·Ğ° 3: TOV UI

- [ ] **ĞšĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ñ‹**
  - [ ] TOVButton
  - [ ] TOVModal
  - [ ] LaborTab
  - [ ] MachineryTab
  - [ ] MaterialsTab

- [ ] **Store**
  - [ ] tovData Map
  - [ ] CRUD actions
  - [ ] Persistence

### Ğ¤Ğ°Ğ·Ğ° 4: Ğ˜Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ñ

- [ ] **Monolit â†’ Registry**
  - [ ] ĞšĞ½Ğ¾Ğ¿ĞºĞ° ÑĞºÑĞ¿Ğ¾Ñ€Ñ‚Ğ°
  - [ ] API Ğ²Ñ‹Ğ·Ğ¾Ğ²
  - [ ] ĞĞ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ° Ğ¾Ñ‚Ğ²ĞµÑ‚Ğ°

- [ ] **Registry â†’ Monolit**
  - [ ] ĞšĞ½Ğ¾Ğ¿ĞºĞ° "ĞšĞ°Ğ»ÑŒĞºÑƒĞ»Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ"
  - [ ] ĞŸĞµÑ€ĞµĞ´Ğ°Ñ‡Ğ° Ğ¿Ğ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ğ¾Ğ²
  - [ ] ĞŸĞ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ğµ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ğ°

- [ ] **URS â†’ Registry**
  - [ ] ĞšĞ½Ğ¾Ğ¿ĞºĞ° ÑĞºÑĞ¿Ğ¾Ñ€Ñ‚Ğ°
  - [ ] Bulk export
  - [ ] Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ ÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸

---

## Ğ¡Ğ»ĞµĞ´ÑƒÑÑ‰Ğ¸Ğµ ÑˆĞ°Ğ³Ğ¸

1. **ĞĞ°Ñ‡Ğ°Ñ‚ÑŒ Ñ Ğ¤Ğ°Ğ·Ñ‹ 1.1** â€” Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ `portalProjectId` Ğ² Registry
2. Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ `UNIFIED_DATA_MODEL.ts` Ñ TypeScript Ğ¸Ğ½Ñ‚ĞµÑ€Ñ„ĞµĞ¹ÑĞ°Ğ¼Ğ¸
3. Ğ ĞµĞ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ±Ğ°Ğ·Ğ¾Ğ²Ñ‹Ğ¹ TOV UI Ğ±ĞµĞ· ĞºĞ°Ğ»ÑŒĞºÑƒĞ»ÑÑ‚Ğ¾Ñ€Ğ¾Ğ²
4. Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ API ÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸
5. Ğ˜Ğ½Ñ‚ĞµĞ³Ñ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ ĞºĞ°Ğ»ÑŒĞºÑƒĞ»ÑÑ‚Ğ¾Ñ€Ñ‹

---

*Ğ”Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ÑĞµÑ‚ÑÑ Ğ¿Ğ¾ Ğ¼ĞµÑ€Ğµ Ñ€ĞµĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸. ĞŸĞ¾ÑĞ»ĞµĞ´Ğ½ĞµĞµ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ: 2026-02-04*
