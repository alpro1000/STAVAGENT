# Migration 004: Normalize Project IDs

## –ü—Ä–æ–±–ª–µ–º–∞

–ü—Ä–æ–µ–∫—Ç—ã —Å–æ–∑–¥–∞–Ω–Ω—ã–µ **–≤—Ä—É—á–Ω—É—é** –º–æ–≥—É—Ç –∏–º–µ—Ç—å ID —Å –ø—Ä–æ–±–µ–ª–∞–º–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä `"SO 13-20-01"`), –∞ –ø—Ä–æ–µ–∫—Ç—ã –∏–∑ **Excel –∏–º–ø–æ—Ä—Ç–∞** –∏–º–µ—é—Ç ID –±–µ–∑ –ø—Ä–æ–±–µ–ª–æ–≤ (`"SO13-20-01"`).

–≠—Ç–æ —Å–æ–∑–¥–∞–µ—Ç –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ:
- Frontend –ø—ã—Ç–∞–µ—Ç—Å—è –æ–±—Ä–∞—Ç–∏—Ç—å—Å—è –∫ `SO13-20-01` (–±–µ–∑ –ø—Ä–æ–±–µ–ª–æ–≤)
- Backend –∏—â–µ—Ç –≤ –ë–î –ø—Ä–æ–µ–∫—Ç `SO 13-20-01` (—Å –ø—Ä–æ–±–µ–ª–∞–º–∏)
- –†–µ–∑—É–ª—å—Ç–∞—Ç: **404 Not Found** ‚ùå

## –†–µ—à–µ–Ω–∏–µ

1. **–ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –±—É–¥—É—â–∏—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤** - —Ñ–æ—Ä–º–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Ç–µ–ø–µ—Ä—å —É–¥–∞–ª—è–µ—Ç –≤—Å–µ –ø—Ä–æ–±–µ–ª—ã –∏–∑ ID
2. **–ú–∏–≥—Ä–∞—Ü–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤** - SQL —Å–∫—Ä–∏–ø—Ç –∏—Å–ø—Ä–∞–≤–ª—è–µ—Ç —Å—Ç–∞—Ä—ã–µ –∑–∞–ø–∏—Å–∏

---

## üöÄ –ö–∞–∫ –∑–∞–ø—É—Å—Ç–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ù–∞ –ª–æ–∫–∞–ª—å–Ω–æ–π –ë–î (SQLite)

```bash
cd Monolit-Planner/backend
node scripts/run-migration-004.js
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: –ù–∞ Production –ë–î (PostgreSQL –Ω–∞ Render)

**–®–∞–≥ 1:** –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ –ë–î —á–µ—Ä–µ–∑ Render Dashboard

1. –û—Ç–∫—Ä–æ–π—Ç–µ https://dashboard.render.com
2. –ù–∞–π–¥–∏—Ç–µ —Å–µ—Ä–≤–∏—Å Monolit-Planner (PostgreSQL)
3. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ External Database URL
4. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `psql` –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è:

```bash
psql "postgresql://user:password@host:port/database"
```

**–®–∞–≥ 2:** –ó–∞–ø—É—Å—Ç–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏—é –≤—Ä—É—á–Ω—É—é

```sql
-- 1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, –∫–∞–∫–∏–µ –ø—Ä–æ–µ–∫—Ç—ã –∏–º–µ—é—Ç –ø—Ä–æ–±–µ–ª—ã
SELECT project_id FROM monolith_projects WHERE project_id LIKE '% %';

-- –î–æ–ª–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å: SO 13-20-01, –∏ –¥—Ä—É–≥–∏–µ (–µ—Å–ª–∏ –µ—Å—Ç—å)

-- 2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏—é
UPDATE monolith_projects SET project_id = REPLACE(project_id, ' ', '') WHERE project_id LIKE '% %';
UPDATE bridges SET bridge_id = REPLACE(bridge_id, ' ', '') WHERE bridge_id LIKE '% %';
UPDATE positions SET bridge_id = REPLACE(bridge_id, ' ', '') WHERE bridge_id LIKE '% %';
UPDATE parts SET project_id = REPLACE(project_id, ' ', '') WHERE project_id LIKE '% %';
UPDATE snapshots SET bridge_id = REPLACE(bridge_id, ' ', '') WHERE bridge_id LIKE '% %';

-- 3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç
SELECT project_id FROM monolith_projects WHERE project_id LIKE '% %';

-- –î–æ–ª–∂–Ω–æ –±—ã—Ç—å –ø—É—Å—Ç–æ (0 rows)
```

**–®–∞–≥ 3:** –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç

```sql
-- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –ø—Ä–æ–µ–∫—Ç —Ç–µ–ø–µ—Ä—å –±–µ–∑ –ø—Ä–æ–±–µ–ª–æ–≤
SELECT project_id, object_name FROM monolith_projects WHERE project_id LIKE 'SO13-20-01%';

-- –î–æ–ª–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å: SO13-20-01 (–±–µ–∑ –ø—Ä–æ–±–µ–ª–æ–≤)
```

---

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ –º–∏–≥—Ä–∞—Ü–∏–∏

1. –û—Ç–∫—Ä–æ–π—Ç–µ Monolit Planner
2. –ù–∞–π–¥–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç SO13-20-01 –≤ —Å–∞–π–¥–±–∞—Ä–µ
3. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∑–∞–≤–µ—Ä—à–∏—Ç—å –æ–±—ä–µ–∫—Ç: –∫–Ω–æ–ø–∫–∞ "‚úì Dokonƒçit objekt"
4. **–û–∂–∏–¥–∞–µ—Ç—Å—è:** –ü—Ä–æ–µ–∫—Ç —É—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à–µ–Ω, —Å—Ç–∞—Ç—É—Å –∏–∑–º–µ–Ω–µ–Ω –Ω–∞ "completed" ‚úÖ
5. **–ù–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å:** 404 Not Found ‚ùå

---

## üìù –ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å –≤ –∫–æ–¥–µ

### 1. CreateMonolithForm.tsx
```javascript
// –ë–´–õ–û (—Ç–æ–ª—å–∫–æ trim –ø–æ –∫—Ä–∞—è–º):
const trimmedBridgeId = bridgeId.trim();

// –°–¢–ê–õ–û (—É–¥–∞–ª—è—é—Ç—Å—è –í–°–ï –ø—Ä–æ–±–µ–ª—ã):
const normalizedBridgeId = bridgeId.trim().replace(/\s+/g, '');
```

### 2. –ú–∏–≥—Ä–∞—Ü–∏—è –ë–î
- `004_normalize_project_ids.sql` - SQL —Å–∫—Ä–∏–ø—Ç –¥–ª—è –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏
- `run-migration-004.js` - Node.js —Å–∫—Ä–∏–ø—Ç –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –º–∏–≥—Ä–∞—Ü–∏–∏

---

## üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

–ï—Å–ª–∏ –≤—Å—ë –µ—â—ë –ø–æ–ª—É—á–∞–µ—Ç–µ 404 –ø–æ—Å–ª–µ –º–∏–≥—Ä–∞—Ü–∏–∏:

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ backend –ª–æ–≥–∏ –Ω–∞ Render:
```
[PUT PROJECT] Updating project with ID: "SO13-20-01"
[PUT PROJECT] Project not found with ID: "SO13-20-01"
[PUT PROJECT] Existing projects: SO13-20-01, ...
```

2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–æ—Ä–º–∞—Ç ID –≤ –ë–î:
```sql
SELECT project_id, LENGTH(project_id), object_name
FROM monolith_projects
WHERE project_id LIKE '%13-20-01%';
```

3. –ï—Å–ª–∏ ID –≤—Å—ë –µ—â—ë —Å –ø—Ä–æ–±–µ–ª–∞–º–∏ - –∑–∞–ø—É—Å—Ç–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏—é –ø–æ–≤—Ç–æ—Ä–Ω–æ

---

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- –ö–æ–º–º–∏—Ç—ã: `bf199c4` (–ø–æ—Å–ª–µ–¥–Ω–∏–π –≤ —Å–µ—Å—Å–∏–∏)
- –í–µ—Ç–∫–∞: `claude/create-onboarding-guide-E4wrx`
- –î–∞—Ç–∞: 2026-01-19
